
﻿
var JIFEN_TRIP=JIFEN_TRIP||{};window.QQ_FROM_API=JIFEN.QQ_FROM_API;JIFEN_TRIP.config=JIFEN_TRIP.config||{};JIFEN_TRIP.config.fiveair={'csair':10281,'ceair':10278,'hnair':10279,'shenzhenair':10280,'scal':10277};JIFEN_TRIP.config.isQQAir=function(mid){for(var name in JIFEN_TRIP.config.fiveair){if(name==mid){return true;}}
return false;};JIFEN_TRIP.config.dateShortFormat=['my_jifen.html'];JIFEN_TRIP.config.isShortFormat=function(){var curHref=window.location.href;var ar=JIFEN_TRIP.config.dateShortFormat;for(var i=0,len=ar.length;i<len;i++){if(curHref.indexOf(ar[i])!=-1){return true;}}
return false;}
JIFEN_TRIP.natureDate=function(date){if(!(date instanceof Date)){return'';}
if(window.location.href.indexOf("trip")==-1&&window.location.href.indexOf("use_jifen_cash.html")==-1){return'';}
var nature;var now=new Date();date.setHours(0,0,0,0);now.setHours(0,0,0,0);var daysDiff=parseInt((date.getTime()-now.getTime())/(24*3600*1000));var nature;switch(daysDiff){case-2:nature='前天';break;case-1:nature='昨天';break;case 0:nature='今天';break;case 1:nature='明天';break;case 2:nature='后天';break;default:var weekMap={'sun':'日','mon':'一','tue':'二','wed':'三','thu':'四','fri':'五','sat':'六'};var week=date.toString().substr(0,3).toLowerCase();nature='星期'+weekMap[week];}
return nature;};JIFEN_TRIP.nextTwoDate=function(){var now=new Date();now.setHours(0,0,0,0);var next=2*(24*3600*1000)+now.getTime();now=new Date(next);var y=now.getFullYear(next),m=now.getMonth(next)+1,d=now.getDate(next);m=m<10?('0'+m):m;d=d<10?('0'+d):d;if(window.location.href.indexOf("trip")==-1&&window.location.href.indexOf("use_jifen_cash.html")==-1&&window.location.href.indexOf("jifen")==-1){return y+'-'+m+'-'+d;}else{return y+'-'+m+'-'+d+' 后天';}}
var CFG_FLIGHT_CITY_LIST_URL='http://imgcache.qq.com/club/cbjifen/v2/static/trip/flight/[%=@mall_id%]_v2.js';var CFG_HOTEL_CITY_LIST_URL='http://imgcache.qq.com/club/cbjifen/v2/static/trip/hotel/[%=@mall_id%]_v2.js';var CFG_VACATION_CITY_LIST_URL='http://imgcache.qq.com/club/cbjifen/v2/static/trip/vacation/[%=@mall_id%]_v2.js';var CFG_TRAIN_CITY_LIST_URL='http://imgcache.qq.com/club/cbjifen/v2/static/trip/train/[%=@mall_id%]_v2.js';var CFG_FLIGHT_CITY={};var _cityList={};var _hotelCityList={};var _vacationCityList={};var _trainCityList={};var _hotelPriceList={"mangocity":{"0":"不限","0-200":"200元以下","200-500":"200-500元","500-800":"500-800元","800-99999":"800元以上"},"qmango":{"0":"不限","0-100":"100元以下","100-200":"100至200元","300-9999":"300元以上"},"elong":{"0":"不限","0-150":"150元以下","150-300":"150至300元","300-600":"300-600元","600-99999":"600元以上"},"ctrip":{"0":"不限","0-200":"200元以下","200-500":"200-500元","500-800":"500-800元","800-99999":"800元以上"},"517hk":{"0":"不限","500":"500元以下","500-800":"500-800元","800-1200":"800-1200元","1200-1600":"1200-1600元","1600":"1600元以上"},"7daysinn":{"0":"不限"},"17u":{"0":"不限"}};function getFlightCityListURL(mall_id){return CFG_FLIGHT_CITY_LIST_URL.replace(/\[%=@mall_id%\]/g,mall_id);};function getHotelCityListURL(mall_id){return CFG_HOTEL_CITY_LIST_URL.replace(/\[%=@mall_id%\]/g,mall_id);};function getVacationCityListURL(mall_id){return CFG_VACATION_CITY_LIST_URL.replace(/\[%=@mall_id%\]/g,mall_id);};function getTrainCityListURL(mall_id){return CFG_TRAIN_CITY_LIST_URL.replace(/\[%=@mall_id%\]/g,mall_id);};JIFEN_TRIP.Data=(function(){var _hotCityList={"PEK":["北京","beijing","bj"],"SZX":["深圳","shenzhen","sz"],"SHA":["上海","shanghai","sh"],"SYX":["三亚","sanya","sy"],"CTU":["成都","chengdu","cd"],"XMN":["厦门","xiamen","xm"],"HGH":["杭州","hangzhou","hz"],"CGQ":["长春","changchun","cc"],"CSX":["长沙","changsha","cs"],"CKG":["重庆","chongqing","cq"],"DLC":["大连","dalian","dl"],"CAN":["广州","guangzhou","gz"],"KWL":["桂林","guilin","gl"],"KWE":["贵阳","guiyang","gy"],"HRB":["哈尔滨","haerbin","heb"],"HAK":["海口","haikou","hk"],"HFE":["合肥","hefei","hf"],"KMG":["昆明","kunming","km"],"LHW":["兰州","lanzhou","lz"],"KHN":["南昌","nanchang","nc"],"NKG":["南京","nanjing","nj"],"NNG":["南宁","nanning","nn"],"TAO":["青岛","qingdao","qd"],"SHE":["沈阳","shenyang","sy"],"TSN":["天津","tianjin","tj"],"WNZ":["温州","wenzhou","wz"],"WUH":["武汉","wuhan","wh"],"CGO":["郑州","zhengzhou","zz"]};var _flightCityTabList={'hot':['','','热门城市'],'a':['a','g','ABC DEFG'],'h':['h','n','HIJK LMN'],'o':['o','t','OPQ RST'],'u':['u','z','UVW XYZ']};function _getHotCityList(){return _hotCityList;}
function _asynGetCityList(mall_id,flag){var flag=flag||0;var jsonUrl='';switch(flag){case 0:jsonUrl=getFlightCityListURL(mall_id);break;case 1:jsonUrl=getHotelCityListURL(mall_id);break;case 2:jsonUrl=getVacationCityListURL(mall_id);break;case 4:jsonUrl=getTrainCityListURL(mall_id);break;default:_cityList=_hotCityList;}
$.getScript(jsonUrl,function(){var para_name='',data={};switch(flag){case 0:para_name='data_flight_'+mall_id;data=eval('('+para_name+')');break;case 1:para_name='data_hotel_'+mall_id;data=eval('('+para_name+')');break;case 2:para_name='data_vacation_'+mall_id;data=eval('('+para_name+')');break;case 4:para_name='data_train_'+mall_id;data=eval('('+para_name+')');break;default:return;}
var mall=data.mall_id;switch(flag){case 0:_cityList[mall]=data.city_list;break;case 1:_hotelCityList[mall]=data.city_list;break;case 2:_vacationCityList[mall]={};if(data['fromcity_list']){_vacationCityList[mall].from=data.fromcity_list;}else{_vacationCityList[mall].from=data.city_list;}
if(data['tocity_list']){_vacationCityList[mall].to=data.tocity_list;}else{_vacationCityList[mall].to=data.city_list;}
break;case 4:_trainCityList[mall]=data.city_list;break;default:return;}});}
(function(){$('#flight_city_add').length&&_asynGetCityList("ctrip",0);$('#ticket_select').val()&&_asynGetCityList($('#ticket_select').val(),0);var hotel_mall=$('#hotel_mall').val();hotel_mall&&_asynGetCityList(hotel_mall,1);hotel_mall&&_setHotelPriceSlt(hotel_mall,'price_select');$('#vacation_mall').val()&&_asynGetCityList($('#vacation_mall').val(),2);$('#hotel_mall_hk').val()&&_asynGetCityList($('#hotel_mall_hk').val(),1);$('#train_mall').val()&&_asynGetCityList($('#train_mall').val(),4);})();function _getCityList(mall_id,flag){var flag=flag||0;if(flag==0){if(_cityList[mall_id]!=null){return _cityList[mall_id];}
else{(function(){_asynGetCityList(mall_id,flag);})();return _cityList[mall_id];}}
else if(flag==1){if(_hotelCityList[mall_id]!=null){return _hotelCityList[mall_id];}
else{(function(){_asynGetCityList(mall_id,flag);})();return _hotelCityList[mall_id];}}
else if(flag==2){if(_vacationCityList[mall_id]!=null){return _vacationCityList[mall_id];}
else{(function(){_asynGetCityList(mall_id,flag);})();return _vacationCityList[mall_id];}}
else if(flag==4){if(_trainCityList[mall_id]!=null){return _trainCityList[mall_id];}
else{(function(){_asynGetCityList(mall_id,flag);})();return _trainCityList[mall_id];}}}
function _getFlightCityTabList(){return _flightCityTabList;}
function _setHotelPriceSlt(mall_id,select_id){var priceSlt=document.getElementById(select_id);priceSlt.options.length=0;var i=0;for(var value in _hotelPriceList[mall_id]){priceSlt.options[i]=new Option(_hotelPriceList[mall_id][value],value);i++;}}
function _getCity(key,flag,mall_id){var flag=flag||0,mall_id=mall_id||'';if(flag==0){if(_cityList[mall_id].hasOwnProperty(key)){return _cityList[mall_id][key];}
if(_hotCityList.hasOwnProperty(key)){return _hotCityList[key];}}
else if(flag==1){if(_hotelCityList[mall_id].hasOwnProperty(key)){return _hotelCityList[mall_id][key];}
if(_hotCityList.hasOwnProperty(key)){return _hotCityList[key];}}
else if(flag==2){if(_vacationCityList[mall_id].from.hasOwnProperty(key)){return _vacationCityList[mall_id].from[key];}
if(_hotCityList.hasOwnProperty(key)){return _hotCityList[key];}}
else if(flag==3){if(_hotCityList.hasOwnProperty(key)){for(var code in _vacationCityList[mall_id].to){if((_vacationCityList[mall_id].to[code][1]==_hotCityList[key][1])){return _vacationCityList[mall_id].to[code];}}}
else if(_vacationCityList[mall_id].to.hasOwnProperty(key)){return _vacationCityList[mall_id].to[key];}}
else if(flag==4){if(_trainCityList[mall_id].hasOwnProperty(key)){return _trainCityList[mall_id][key];}
if(_hotCityList.hasOwnProperty(key)){return _hotCityList[key];}}
return[];}
function _getCityCode(name,flag,mall_id){var flag=flag||0,mall_id=mall_id||'';if(!name){return'';}
if(flag==0){for(var code in _cityList[mall_id]){var city=_cityList[mall_id][code];if(city[0]==name||city[1]==name||(city[2]&&city[2]==name)||name.toUpperCase()==code){if(mall_id=="ctrip"){return city[0];}
else{return code;}}}}
else if(flag==1){for(var code in _hotelCityList[mall_id]){var city=_hotelCityList[mall_id][code];if(city[0]==name||city[1]==name||(city[2]&&city[2]==name)||name.toUpperCase()==code){return code;}}}
else if(flag==2){for(var code in _vacationCityList[mall_id].from){var city=_vacationCityList[mall_id].from[code];if(city[0]==name||city[1]==name||(city[2]&&city[2]==name)||name.toUpperCase()==code){if(mall_id=="ctrip"){return city[0];}
else{return code;}}}}
else if(flag==3){for(var code in _vacationCityList[mall_id].to){var city=_vacationCityList[mall_id].to[code];if(city[0]==name||city[1]==name||(city[2]&&city[2]==name)||name.toUpperCase()==code){if(mall_id=="ctrip"){return city[0];}
else{return code;}}}}
else if(flag==4){for(var code in _trainCityList[mall_id]){var city=_trainCityList[mall_id][code];if(city[0]==name||city[1]==name||(city[2]&&city[2]==name)||name.toUpperCase()==code){return[code,$.trim(city[1])];}}}
return'';}
function _getCityNameByCode(code,mall_id,type){var mall_id=mall_id||'ctrip',type=type||1;switch(parseInt(type)){case 1:if(_cityList[mall_id]!=null&&_cityList[mall_id][code]&&_cityList[mall_id][code][0]){return _cityList[mall_id][code][0];}
else{(function(){_asynGetCityList(mall_id);})();if(_cityList[mall_id]&&_cityList[mall_id][code]&&_cityList[mall_id][code][0])
return _cityList[mall_id][code][0];}
break;case 2:case 4:if(_hotelCityList[mall_id]!=null&&_hotelCityList[mall_id][code]&&_hotelCityList[mall_id][code][0]){return _hotelCityList[mall_id][code][0];}
else{(function(){_asynGetCityList(mall_id,1);})();if(_hotelCityList[mall_id]&&_hotelCityList[mall_id][code]&&_hotelCityList[mall_id][code][0])
return _hotelCityList[mall_id][code][0];}
break;case 3:if(_vacationCityList[mall_id]!=null&&_vacationCityList[mall_id]['from'][code]&&_vacationCityList[mall_id]['from'][code][0]){return _vacationCityList[mall_id]['from'][code][0];}
else if(_vacationCityList[mall_id]!=null&&_vacationCityList[mall_id]['to'][code]&&_vacationCityList[mall_id]['to'][code][0]){return _vacationCityList[mall_id]['to'][code][0];}
else{(function(){_asynGetCityList(mall_id,2);})();if(_vacationCityList[mall_id]&&_vacationCityList[mall_id]['from'][code]&&_vacationCityList[mall_id]['from'][code][0])
return _vacationCityList[mall_id]['from'][code][0];if(_vacationCityList[mall_id]&&_vacationCityList[mall_id]['to'][code]&&_vacationCityList[mall_id]['to'][code][0])
return _vacationCityList[mall_id]['to'][code][0];}
break;case 5:if(_trainCityList[mall_id]!=null&&_trainCityList[mall_id].length){var ll=_trainCityList[mall_id].length;for(var i=0;i<ll;i++){if(_trainCityList[mall_id][i]&&_trainCityList[mall_id][i][1]&&_trainCityList[mall_id][i][1]==code){return _trainCityList[mall_id][i][0];}}}
else{(function(){_asynGetCityList(mall_id,4);})();if(_trainCityList[mall_id]!=null&&_trainCityList[mall_id].length){var ll=_trainCityList[mall_id].length;for(var i=0;i<ll;i++){if(_trainCityList[mall_id][i]&&_trainCityList[mall_id][i][1]&&_trainCityList[mall_id][i][1]==code){return _trainCityList[mall_id][i][0];}}}}
break;}
return'undefined';}
return{getHotCityList:_getHotCityList,getCityList:_getCityList,getFlightCityTabList:_getFlightCityTabList,getCity:_getCity,getCityCode:_getCityCode,getCityNameByCode:_getCityNameByCode,asynGetCityList:_asynGetCityList,setHotelPriceSlt:_setHotelPriceSlt};})();function hideSelect(){var argLen=arguments.length;for(var i=0;i<argLen;i++){var selectDom=(typeof arguments[i]=='string')?$('#'+arguments[i]):arguments[i];if(selectDom){selectDom.hide();}}}
function showSelect(){var argLen=arguments.length;for(var i=0;i<argLen;i++){var selectDom=(typeof arguments[i]=='string')?$('#'+arguments[i]):arguments[i];if(selectDom){selectDom.show();}}}
function getAttach(){var search=window.location.search;if(search.indexOf('?')!=-1){var str=search.substr(1);strs=str.split("&");for(i=0;i<strs.length;i++)
{key=strs[i].split("=")[0];value=unescape(strs[i].split("=")[1]);if(key=='attach'){return value;}}}
return'';}
function setInputValue(domId,type,defaultValue){var input=$('#'+domId);if(type=='click'){if(input.val()==defaultValue){input.val('');}}
else if(type=='blur'){if(input.val()==''){input.val(defaultValue);}}}
JIFEN_TRIP.flightBind=function(oneWayId,roundId,fromCityId,fromCityButtonId,toCityId,toCityButtonId,depDateId,depDateButtonId,returnDateId,returnDateButtonId,queryId,selectId,defaultValue,isShowNotFind,isIndex,chMallCb,dateStyle)
{isShowNotFind=isShowNotFind||1;isIndex=isIndex||1;JIFEN_TRIP.flightBind.counter++;$('#'+selectId).bind('change',function(){var mallId=$(this).val();JIFEN_TRIP.Data.getCityList(mallId);if(chMallCb)chMallCb(mallId);});var _oneWay=$('#'+oneWayId);var _round=$('#'+roundId);$('#'+oneWayId).bind('click',function(){_setReturn(0);_oneWay.attr('checked',true);});$('#'+roundId).bind('click',function(){_setReturn(1);});_oneWay.attr('checked',true);var _fromCityName='_fromCity'+JIFEN_TRIP.flightBind.counter;window[_fromCityName]=new JIFEN_TRIP.City(fromCityId,_fromCityName,0,defaultValue,isShowNotFind);$('#'+fromCityId).bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(selectId);}
window[_toCityName].hide();});$('#'+fromCityButtonId).bind('click',function(event){$('#'+fromCityId).click();event.stopPropagation();});var _toCityName='_toCity'+JIFEN_TRIP.flightBind.counter;window[_toCityName]=new JIFEN_TRIP.City(toCityId,_toCityName,0,defaultValue,isShowNotFind);$('#'+toCityId).bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(selectId);}
window[_fromCityName].hide();});$('#'+toCityButtonId).bind('click',function(event){$('#'+toCityId).click();event.stopPropagation();});$('#'+toCityButtonId).next().length&&$('#'+toCityButtonId).next().bind('click',function(event){var temp=$('#'+toCityId).val();$('#'+toCityId).val($('#'+fromCityId).val());$('#'+fromCityId).val(temp);});var _depDate=$('#'+depDateId);_depDate.val(JIFEN_TRIP.nextTwoDate());var _depCalendarName='_depCalendar'+JIFEN_TRIP.flightBind.counter;window[_depCalendarName]=new JIFEN_TRIP.Calendar();if($.browser.msie){_depDate.bind('click',function(event){var depDateStr=JIFEN_TRIP.Calendar.getSelectedDate(depDateId);if(JIFEN_TRIP.Checker.isDateTime(depDateStr,'d')){var depDate=(new Date()).parseDate(depDateStr,'%y%M%d');var depMonth=depDate.getMonth();var threeDaysAgo=depDate.dateAdd('d',-3);if(depMonth!=threeDaysAgo.getMonth()){window[_depCalendarName].changeCalendar(0,0,'%y-%M-%d','n',-1);}}});window[_depCalendarName].tripInit(depDateId,_depCalendarName,function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){_depDate.val(format+' ');}
else{_depDate.val(format+' '+nature);}
var depDate=JIFEN_TRIP.Calendar.getSelectedDate(depDateId);if($('#'+roundId).attr('checked')){var returnDate=JIFEN_TRIP.Calendar.getSelectedDate(returnDateId);if(returnDate==''||!JIFEN_TRIP.Checker.isDateTime(returnDate,'d')||returnDate<depDate){if(JIFEN_TRIP.config.isShortFormat()){_returnDate.val(date.dateAdd('d',3).format('%y-%M-%d '));}
else{_returnDate.val(date.dateAdd('d',3).format('%y-%M-%d %w'));}}
window[_returnCalendarName].config.range.start=format;}});}
else{window[_depCalendarName].tripInit(depDateId,_depCalendarName,function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){_depDate.val(format+' ');}
else{_depDate.val(format+' '+nature);}
var depDate=JIFEN_TRIP.Calendar.getSelectedDate(depDateId);if(_round.attr('checked')){var returnDate=JIFEN_TRIP.Calendar.getSelectedDate(returnDateId);if(returnDate==''||!JIFEN_TRIP.Checker.isDateTime(returnDate,'d')||returnDate<depDate){if(JIFEN_TRIP.config.isShortFormat()){_returnDate.val(date.dateAdd('d',3).format('%y-%M-%d '));}
else{_returnDate.val(date.dateAdd('d',3).format('%y-%M-%d %w'));}}
window[_returnCalendarName].config.range.start=format;}});_depDate.bind('click',function(event){var depDateStr=JIFEN_TRIP.Calendar.getSelectedDate(depDateId);if(JIFEN_TRIP.Checker.isDateTime(depDateStr,'d')){var depDate=(new Date()).parseDate(depDateStr,'%y%M%d');var depMonth=depDate.getMonth();var threeDaysAgo=depDate.dateAdd('d',-3);if(depMonth!=threeDaysAgo.getMonth()){window[_depCalendarName].changeCalendar(0,0,'%y-%M-%d','n',-1);}}});}
$('#'+depDateButtonId).bind('click',function(event){_depDate.click();event.stopPropagation();});var _returnDate=$('#'+returnDateId);_returnDate.val('');var _returnCalendarName='_returnCalendar'+JIFEN_TRIP.flightBind.counter;window[_returnCalendarName]=new JIFEN_TRIP.Calendar();if($.browser.msie){_returnDate.bind('click',function(event){var returnDateStr=JIFEN_TRIP.Calendar.getSelectedDate(returnDateId);if(JIFEN_TRIP.Checker.isDateTime(returnDateStr,'d')){var returnDate=(new Date()).parseDate(returnDateStr,'%y%M%d');var returnMonth=returnDate.getMonth();var threeDaysAgo=returnDate.dateAdd('d',-3);if(returnMonth!=threeDaysAgo.getMonth()){window[_returnCalendarName].changeCalendar(0,0,'%y-%M-%d','n',-1);}}});window[_returnCalendarName].tripInit(returnDateId,_returnCalendarName);}
else{window[_returnCalendarName].tripInit(returnDateId,_returnCalendarName);_returnDate.bind('click',function(event){var returnDateStr=JIFEN_TRIP.Calendar.getSelectedDate(returnDateId);if(JIFEN_TRIP.Checker.isDateTime(returnDateStr,'d')){var returnDate=(new Date()).parseDate(returnDateStr,'%y%M%d');var returnMonth=returnDate.getMonth();var threeDaysAgo=returnDate.dateAdd('d',-3);if(returnMonth!=threeDaysAgo.getMonth()){window[_returnCalendarName].changeCalendar(0,0,'%y-%M-%d','n',-1);}}});}
$('#'+returnDateButtonId).bind('click',function(event){if(_round.attr('checked')){_returnDate.click();event.stopPropagation();}});var _query=$('#'+queryId);_query.bind('click',function(event){var mallId=$('#'+selectId).val();event.stopPropagation();var fromCity=$.trim($('#'+fromCityId).val());var toCity=$.trim($('#'+toCityId).val());if(fromCity==toCity){$('#'+toCityId).click();return;}
var depDate=JIFEN_TRIP.Calendar.getSelectedDate(depDateId);var fromCityCode=JIFEN_TRIP.Data.getCityCode(fromCity,0,mallId);var toCityCode=JIFEN_TRIP.Data.getCityCode(toCity,0,mallId)
fromCityCode=fromCityCode?fromCityCode:0;toCityCode=toCityCode?toCityCode:0;if(fromCity==''||fromCity==defaultValue){$('#'+fromCityId).click();return;}else if(toCity==''||toCity==defaultValue){$('#'+toCityId).click();return;}else if(fromCity==toCity){$('#'+toCityId).click();return;}
if(depDate==''){_depDate.click();return;}else if(!JIFEN_TRIP.Checker.isDateTime(depDate,'d')){_depDate.click();return;}
var tripType;var returnDate;if(_round.attr('checked')){tripType='1';returnDate=JIFEN_TRIP.Calendar.getSelectedDate(returnDateId);if(returnDate==''){_returnDate.click();return;}else if(!JIFEN_TRIP.Checker.isDateTime(returnDate,'d')){_returnDate.click();return;}
if(depDate>returnDate){_returnDate.click();return;}}else{tripType='0';returnDate='';}
setTimeout(function(){$.getJSON(JIFEN.gPrefixHost+'/trip/cb_session_cmd.php?callback=?',{cmd:'in',iType:1,from:mallId=='ctrip'?fromCityCode:fromCity,to:mallId=='ctrip'?toCityCode:toCity,begdate:depDate,enddate:returnDate,mall:mallId},function(data){});},0);if(mallId=='goldenholiday'){returnDate=(returnDate=='')?0:returnDate;var queryString="http://caibei.goldenholiday.com/CaiBei/QQCBIndex.aspx?fromCity="+fromCityCode+"&toCity="+toCityCode+"&depDate="+depDate+"&returnDate="+returnDate;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10118&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='mangocity'){returnDate=(returnDate=='')?0:returnDate;var queryString="http://www.mangocity.com/caibei/tocb.html?fromCity="+fromCityCode+"&toCity="+toCityCode+"&depDate="+depDate+"&returnDate="+returnDate;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10131&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='ctrip'){var FlightWay=(returnDate=='')?0:1;returnDate=(returnDate=='')?0:returnDate;var tDepDate=depDate.substr(0,4)+'-'+depDate.substr(4,2)+'-'+depDate.substr(6,2);var queryString="http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=20&FlightWay="+FlightWay+"&StartCity="+encodeURIComponent(encodeURIComponent(encodeURIComponent(fromCityCode)))+"&DestCity="+encodeURIComponent(encodeURIComponent(encodeURIComponent(toCityCode)))+"&DepartDate="+tDepDate+(FlightWay==1?"&ReturnDate="+returnDate:"");queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10333&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='elong'){returnDate=(returnDate=='')?0:returnDate;var tDepDate=depDate.substr(0,4)+'-'+depDate.substr(4,2)+'-'+depDate.substr(6,2);if(_round.attr('checked')){var queryString="http://flight.elong.com/search/cn_round_trip_"+encodeURIComponent(fromCityCode)+"_"+encodeURIComponent(toCityCode)+"_"+tDepDate+"_"+returnDate+"_Y.html";}else{var queryString="http://flight.elong.com/search/cn_list_"+encodeURIComponent(fromCityCode)+"_"+encodeURIComponent(toCityCode)+"_"+tDepDate+"_Y.html";}
queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10021&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='cococ'){returnDate=(returnDate=='')?0:returnDate;var queryString="http://caibei.feiren.com/caibei/search.php?source=caibei&fromCity="+fromCityCode+"&toCity="+toCityCode+"&depDate="+depDate+"&returnDate="+returnDate;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10238&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='csair'){returnDate=(returnDate=='')?'':returnDate;var iType=(returnDate=='')?1:2;var queryString="http://jipiao.qq.com/query_result.shtml?from="+fromCityCode+"&to="+toCityCode+"&back_radio="+iType+"&date="+depDate+"&date2="+returnDate;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10370&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}
else if(mallId=='17u'){returnDate=(returnDate=='')?0:returnDate.substr(0,4)+'-'+returnDate.substr(4,2)+'-'+returnDate.substr(6,2);var tDepDate=depDate.substr(0,4)+'-'+depDate.substr(4,2)+'-'+depDate.substr(6,2);var queryString="http://tcopenapi.17usoft.com/bdextapi/CaiBei/FlightRedirect/?fromCity="+fromCityCode+"&toCity="+toCityCode+"&depDate="+tDepDate+"&returnDate="+returnDate;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10404&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;}});function _setReturn(status){if(status==1){_returnDate.attr('disabled',false);$('#'+returnDateButtonId).attr('disabled',false);if(dateStyle&&dateStyle[0]){_returnDate.attr('class',dateStyle[0]);}
else if(isIndex==1){_returnDate.attr('class','bd0 sy_mod_icoipt ipt_edate');}
else if(isIndex==2){_returnDate.attr('class','bd0 get_mod_icoipt ipt_sdate');}
_oneWay.attr('checked',false);_round.attr('checked',true);var depDate=_depDate.val();if(depDate!=''){depDate=depDate.substr(0,depDate.indexOf(' '));var valid=(new Date()).validDate(depDate,'%y-%M-%d');if(valid.isValid){var returnDate=new Date(valid.date.getTime()+72*3600*1000);if(JIFEN_TRIP.config.isShortFormat()){_returnDate.val(returnDate.format("%y-%M-%d")+' ');}
else{_returnDate.val(returnDate.format("%y-%M-%d")+' '+JIFEN_TRIP.natureDate(returnDate));}
window[_returnCalendarName].config.range.start=depDate;}}}else{_returnDate.attr('disabled',true);$('#'+returnDateButtonId).attr('disabled',true);if(dateStyle&&dateStyle[1]){_returnDate.attr('class',dateStyle[1]);}
else if(isIndex==1){_returnDate.attr('class','bd0 sy_mod_icoipt ipt_edate sy_mod_icoipt0');}
else if(isIndex==2){_returnDate.attr('class','bd0 get_mod_icoipt ipt_edate get_mod_icoipt_disable');}
_oneWay.attr('checked',true);_round.attr('checked',false);_returnDate.val('');}}}
JIFEN_TRIP.flightBind.counter=0;JIFEN_TRIP.hotelBind=function(liveCityId,liveCityButtonId,checkinDateId,checkinDateButtonId,checkoutDateId,checkoutDateButtonId,keywordId,priceSelectId,mallSelectId,queryId,cityDefaultValue,hotelDefaultValue,isShowNotFind,chMallCb)
{var gHotelOption={};isShowNotFind=isShowNotFind?isShowNotFind:1;JIFEN_TRIP.hotelBind.counter++;var _mallSelectId=$('#'+mallSelectId);var _liveCity=$('#'+liveCityId);var _liveCityButton=$('#'+liveCityButtonId);var _keyword=$('#'+keywordId);var _priceSelect=$('#'+priceSelectId);var _liveCityName='_liveCity'+JIFEN_TRIP.hotelBind.counter;var _checkinDate=$('#'+checkinDateId);var _checkinDateButton=$('#'+checkinDateButtonId);var _checkinCalendarName='_checkinCalendar'+JIFEN_TRIP.hotelBind.counter;var _checkoutDate=$('#'+checkoutDateId);var _checkoutDateButton=$('#'+checkoutDateButtonId);var _checkoutCalendarName='_checkoutCalendar'+JIFEN_TRIP.hotelBind.counter;_liveCity.bind(liveCityId,function(){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(priceSelectId,mallSelectId);}
setInputValue(liveCityId,'click',cityDefaultValue);});_liveCity.bind('blur',function(){setInputValue(liveCityId,'blur',cityDefaultValue);});_keyword.bind('click',function(){setInputValue(keywordId,'click',hotelDefaultValue);});_keyword.bind('blur',function(){setInputValue(keywordId,'blur',hotelDefaultValue);});_mallSelectId.bind('change',function(){var mallId=_mallSelectId.val();if(mallSelectId=='hotel_mall'){JIFEN_TRIP.Data.setHotelPriceSlt(mallId,'price_select');JIFEN_TRIP.Data.getCityList(mallId,1);}
else if(mallSelectId=='hotel_mall_hk'){JIFEN_TRIP.Data.setHotelPriceSlt(mallId,'price_select_hk');}
else if(mallSelectId=='selectHotel'){JIFEN_TRIP.Data.setHotelPriceSlt(mallId,'selectPrice');JIFEN_TRIP.Data.getCityList(mallId,1);}
if(chMallCb)chMallCb(mallId);});if(liveCityId.indexOf('hk')==-1){window[_liveCityName]=new JIFEN_TRIP.City(liveCityId,_liveCityName,1,cityDefaultValue,isShowNotFind);_liveCity.bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(priceSelectId,mallSelectId);}});_liveCityButton.bind('click',function(event){_liveCity.click();event.stopPropagation();});}
var strToday=new Date().format('%y-%M-%d');var str1DaysLater=new Date().dateAdd("d",1).format('%y-%M-%d');var str2DaysLater=new Date().dateAdd("d",2).format('%y-%M-%d');gHotelOption.checkin=str1DaysLater;gHotelOption.checkout=str2DaysLater;window[_checkinCalendarName]=new JIFEN_TRIP.Calendar();window[_checkinCalendarName].tripInit(checkinDateId,_checkinCalendarName,function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){_checkinDate.val(format);}
else{_checkinDate.val(format+' '+nature);}
var checkin=JIFEN_TRIP.Calendar.getSelectedDate(checkinDateId);var checkout=JIFEN_TRIP.Calendar.getSelectedDate(checkoutDateId);var checkinDate=new Date().parseDate(checkin,'%y%M%d');var checkoutDate=new Date().parseDate(checkout,'%y%M%d');if(checkin>=checkout){checkoutDate=new Date().parseDate(checkin,'%y%M%d').dateAdd("d",1);if(JIFEN_TRIP.config.isShortFormat()){_checkoutDate.val(checkoutDate.format('%y-%M-%d '));}
else{_checkoutDate.val(checkoutDate.format('%y-%M-%d %w'));}}
gHotelOption.checkin=checkinDate.format('%y-%M-%d');gHotelOption.checkout=checkoutDate.format('%y-%M-%d');window[_checkinCalendarName].config.range.start=new Date().format('%y-%M-%d');window[_checkoutCalendarName].config.range.start=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",1).format('%y-%M-%d');window[_checkoutCalendarName].config.range.end=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",20).format('%y-%M-%d');});_checkinDateButton.bind('click',function(event){_checkinDate.click();event.stopPropagation();});window[_checkoutCalendarName]=new JIFEN_TRIP.Calendar();window[_checkoutCalendarName].tripInit(checkoutDateId,_checkoutCalendarName,function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){_checkoutDate.val(format);}
else{_checkoutDate.val(format+' '+nature);}
var checkin=JIFEN_TRIP.Calendar.getSelectedDate(checkinDateId);var checkout=JIFEN_TRIP.Calendar.getSelectedDate(checkoutDateId);var checkinDate=new Date().parseDate(checkin,'%y%M%d');var checkoutDate=new Date().parseDate(checkout,'%y%M%d');gHotelOption.checkin=checkinDate.format('%y-%M-%d');gHotelOption.checkout=checkoutDate.format('%y-%M-%d');window[_checkoutCalendarName].config.range.start=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",1).format('%y-%M-%d');window[_checkoutCalendarName].config.range.end=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",20).format('%y-%M-%d');});_checkoutDateButton.bind('click',function(event){_checkoutDate.click();event.stopPropagation();});var checkinDate=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d');var checkoutDate=new Date().parseDate(gHotelOption.checkout,'%y-%M-%d');if(JIFEN_TRIP.config.isShortFormat()){_checkinDate.val(checkinDate.format('%y-%M-%d'));_checkoutDate.val(checkoutDate.format('%y-%M-%d'));}
else{_checkinDate.val(checkinDate.format('%y-%M-%d %w'));_checkoutDate.val(checkoutDate.format('%y-%M-%d %w'));}
window[_checkinCalendarName].config.range.end=new Date().dateAdd("d",90).format('%y-%M-%d');window[_checkoutCalendarName].config.range.start=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",1).format('%y-%M-%d');window[_checkoutCalendarName].config.range.end=new Date().parseDate(gHotelOption.checkin,'%y-%M-%d').dateAdd("d",20).format('%y-%M-%d');var _query=$('#'+queryId);_query.bind('click',function(event){var mallId=_mallSelectId.val();event=event||window.event;if(_liveCity.val()==''||_liveCity.val()==cityDefaultValue){_liveCity.click();event.stopPropagation();return;}
else{var city=$.trim(_liveCity.val());var cityCode=JIFEN_TRIP.Data.getCityCode(city,1,mallId)?JIFEN_TRIP.Data.getCityCode(city,1,mallId):'';gHotelOption.cityCode=cityCode;}
if(_keyword.val()!=""&&_keyword.val()!=hotelDefaultValue){gHotelOption.hotel=_keyword.val().replace("<","&lt;").replace(">","&gt;");}else{gHotelOption.hotel='';}
gHotelOption.price=(_priceSelect.val()!='0')?_priceSelect.val():'';if(_checkinDate.val()==''){_checkinDate.click();event.stopPropagation();return;}
else{var date=_checkinDate.val().split(' ');gHotelOption.checkin=date[0];}
if(_checkoutDate.val()==''){_checkoutDate.click();event.stopPropagation();return;}
else{var date=_checkoutDate.val().split(' ');gHotelOption.checkout=date[0];}
if(_checkinDate.val()==_checkoutDate.val()){_checkoutDate.click();event.stopPropagation();return;}
if(queryId.indexOf('hk')!=-1){var sessiontype=4;}
else{var sessiontype=2;}
setTimeout(function(){$.getJSON(JIFEN.gPrefixHost+'/trip/cb_session_cmd.php?callback=?',{cmd:'in',iType:sessiontype,city:city,begdate:gHotelOption.checkin,enddate:gHotelOption.checkout,key:gHotelOption.hotel,price:gHotelOption.price,mall:mallId},function(data){});},0);if(queryId.indexOf('hk')!=-1){if(mallId=='517hk'){var queryString="http://hotel.517hk.com/CBSearchHKHotel.action?city="+gHotelOption.cityCode+"&checkin="+gHotelOption.checkin+"&checkout="+gHotelOption.checkout+"&word="+encodeURIComponent(gHotelOption.hotel)+"&priceStr="+gHotelOption.price;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10149&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='qmango'){var queryString="http://www.qmango.com/ThirdPartLogin/qqcaibei/showhotels.asp?cityCode=018&inDate="+gHotelOption.checkin+"&outDate="+gHotelOption.checkout+"&hotelName="+escape(gHotelOption.hotel)+"&priceStr="+gHotelOption.price;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10162&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}}
else if(mallId=='mangocity'){var queryString="http://hotel.mangocity.com/hotel-query.shtml?cityCode="+gHotelOption.cityCode+"&inDate="+gHotelOption.checkin+"&outDate="+gHotelOption.checkout+"&hotelName="+encodeURIComponent(gHotelOption.hotel)+"&priceStr="+gHotelOption.price;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10131&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='qmango'){var queryString="http://www.qmango.com/ThirdPartLogin/qqcaibei/showhotels.asp?cityCode="+gHotelOption.cityCode+"&inDate="+gHotelOption.checkin+"&outDate="+gHotelOption.checkout+"&hotelName="+escape(gHotelOption.hotel)+"&priceStr="+gHotelOption.price;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10162&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='ctrip'){var prices=gHotelOption.price.split('-');var priceStr="";if(prices[1]){priceStr="&MinPirce="+prices[0]+"&MaxPirce="+prices[1];}
var queryString="http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=10&CityName="+encodeURIComponent(encodeURIComponent(encodeURIComponent(city)))+"&CheckInDate="+gHotelOption.checkin+"&CheckOutDate="+gHotelOption.checkout+priceStr+"&HotelName="+encodeURIComponent(encodeURIComponent(encodeURIComponent(gHotelOption.hotel)));queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10333&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='elong'){var prices=gHotelOption.price.split('-');var priceStr="";if(prices[1]){priceStr="&LowPrice="+prices[0]+"&HighPrice="+prices[1];}
var queryString="http://hotel.elong.com/search/list_cn_"+gHotelOption.cityCode+".html?CheckInDate="+gHotelOption.checkin+"&CheckOutDate="+gHotelOption.checkout+priceStr+"&HotelName="+escape(gHotelOption.hotel);queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10021&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='7daysinn'){var prices=gHotelOption.price.split('-');var priceStr="";if(prices[1]){priceStr="&LowPrice="+prices[0]+"&HighPrice="+prices[1];}
var queryString="http://e.7daysinn.cn/market/index.php?sid=112673&action=index&city="+encodeURIComponent(city)+"&dtStart="+gHotelOption.checkin+"&dtEnd="+gHotelOption.checkout;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1011.00.000.00&mall_id=10334&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='17u'){var queryString="http://tcopenapi.17usoft.com/bdextapi/CaiBei/HotelRedirect/?cityName="+city+"&comeDate="+gHotelOption.checkin+"&leaveDate="+gHotelOption.checkout+'&keyword='+gHotelOption.hotel;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1011.00.000.00&mall_id=10404&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}});}
JIFEN_TRIP.hotelBind.counter=0;JIFEN_TRIP.vacationBind=function(fromCityId,fromCityButtonId,toCityId,toCityButtonId,mallSelectId,queryId,cityDefaultValue,isShowNotFind,chMallCb)
{isShowNotFind=isShowNotFind?isShowNotFind:1;JIFEN_TRIP.vacationBind.counter++;var gVacationOption={};var _mallSelectId=$('#'+mallSelectId);var _fromCity=$('#'+fromCityId);var _fromCityButton=$('#'+fromCityButtonId);var _fromCityNameVacation='_fromCityVacation'+JIFEN_TRIP.vacationBind.counter;var _toCity=$('#'+toCityId);var _toCityButton=$('#'+toCityButtonId);var _toCityNameVacation='_toCityVacation'+JIFEN_TRIP.vacationBind.counter;_mallSelectId.bind('change',function(){var mallId=_mallSelectId.val();JIFEN_TRIP.Data.getCityList(mallId,2);if(chMallCb)chMallCb(mallId);});window[_fromCityNameVacation]=new JIFEN_TRIP.City(fromCityId,_fromCityNameVacation,2,cityDefaultValue,isShowNotFind);_fromCity.bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(mallSelectId);}
window[_toCityNameVacation].hide();});_fromCityButton.bind('click',function(event){_fromCity.click();event.stopPropagation();});window[_toCityNameVacation]=new JIFEN_TRIP.City(toCityId,_toCityNameVacation,3,cityDefaultValue,isShowNotFind);_toCity.bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(mallSelectId);}
window[_fromCityNameVacation].hide();});_toCityButton.bind('click',function(event){_toCity.click();event.stopPropagation();});_toCityButton.next().bind('click',function(event){var temp=$('#'+toCityId).val();$('#'+toCityId).val($('#'+fromCityId).val());$('#'+fromCityId).val(temp);});var _query=$('#'+queryId);_query.bind('click',function(event){event=event||window.event;event.stopPropagation();var mallId=_mallSelectId.val();var fromCity=$.trim(_fromCity.val());var toCity=$.trim(_toCity.val());var fromCityCode=JIFEN_TRIP.Data.getCityCode(fromCity,2,mallId);var toCityCode=JIFEN_TRIP.Data.getCityCode(toCity,3,mallId);fromCityCode=fromCityCode?fromCityCode:0;toCityCode=toCityCode?toCityCode:0;if(fromCity==''||fromCity==cityDefaultValue){_fromCity.click();return;}else if(toCity==''||toCity==cityDefaultValue){_toCity.click();return;}else if(fromCity==toCity){_toCity.click();return;}
setTimeout(function(){$.getJSON(JIFEN.gPrefixHost+'/trip/cb_session_cmd.php?callback=?',{cmd:'in',iType:3,from:mallId=='ctrip'?fromCityCode:fromCity,to:mallId=='ctrip'?toCityCode:toCity,mall:mallId},function(data){});},0);if(mallId=='mangocity'){var queryString="http://lvyou.mangocity.com/line-"+fromCityCode+"-"+toCityCode;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10131&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='ctrip'){var queryString="http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=30&StartCity="+encodeURIComponent(encodeURIComponent(encodeURIComponent(fromCityCode)))+"&SearchValue="+encodeURIComponent(encodeURIComponent(encodeURIComponent(toCityCode)))+"&Channel=3&CurrentTab=126";queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10333&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}
else if(mallId=='17u'){var queryString="http://tcopenapi.17usoft.com/bdextapi/CaiBei/HolidayRedirect/?fromCity="+fromCity+"&toCity="+toCity;queryString=encodeURIComponent(queryString);queryUrl="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10404&forcelogin=1&login_type=1&toURL="+queryString;var attach=getAttach();$('#'+queryId).attr({'href':queryUrl,'target':'_blank'});return true;}});}
JIFEN_TRIP.vacationBind.counter=0;JIFEN_TRIP.trainBind=function(fromCityId,fromCityButtonId,toCityId,toCityButtonId,leaveDateId,leaveDateButtonId,mallSelectId,queryId,cityDefaultValue,isShowNotFind,chMallCb)
{isShowNotFind=isShowNotFind?isShowNotFind:1;JIFEN_TRIP.trainBind.counter++;var gTrainOption={};var _mallSelectId=$('#'+mallSelectId);var _fromCity=$('#'+fromCityId);var _fromCityButton=$('#'+fromCityButtonId);var _fromCityNameTrain='_fromCityTrain'+JIFEN_TRIP.trainBind.counter;var _toCity=$('#'+toCityId);var _toCityButton=$('#'+toCityButtonId);var _toCityNameTrain='_toCityTrain'+JIFEN_TRIP.trainBind.counter;var _leaveDate=$('#'+leaveDateId);var _leaveDateButton=$('#'+leaveDateButtonId);var _leaveCalendarName='_leaveCalendar'+JIFEN_TRIP.trainBind.counter;_mallSelectId.bind('change',function(){var mallId=_mallSelectId.val();if(chMallCb)chMallCb(mallId);});window[_fromCityNameTrain]=new JIFEN_TRIP.City(fromCityId,_fromCityNameTrain,4,cityDefaultValue,isShowNotFind);_fromCity.bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(mallSelectId);}
window[_toCityNameTrain].hide();});_fromCityButton.bind('click',function(event){_fromCity.click();event.stopPropagation();});window[_toCityNameTrain]=new JIFEN_TRIP.City(toCityId,_toCityNameTrain,4,cityDefaultValue,isShowNotFind);_toCity.bind('click',function(event){if($.browser.msie&&parseInt($.browser.version)<7){hideSelect(mallSelectId);}
window[_fromCityNameTrain].hide();});_toCityButton.bind('click',function(event){_toCity.click();event.stopPropagation();});_toCityButton.next().bind('click',function(event){var temp=$('#'+toCityId).val();$('#'+toCityId).val($('#'+fromCityId).val());$('#'+fromCityId).val(temp);});window[_leaveCalendarName]=new JIFEN_TRIP.Calendar();window[_leaveCalendarName].tripInit(leaveDateId,_leaveCalendarName,function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){_leaveDate.val(format);}
else{_leaveDate.val(format+' '+nature);}
var date=JIFEN_TRIP.Calendar.getSelectedDate(leaveDateId);var leaveDate=new Date().parseDate(date,'%y%M%d');gTrainOption.date=leaveDate.format('%y-%M-%d');window[_leaveCalendarName].config.range.start=new Date().format('%y-%M-%d');});_leaveDateButton.bind('click',function(event){_leaveDate.click();event.stopPropagation();});var leaveDate=new Date().parseDate(gTrainOption.date,'%y-%M-%d');if(JIFEN_TRIP.config.isShortFormat()){_leaveDate.val(leaveDate.format('%y-%M-%d'));}
else{_leaveDate.val(leaveDate.format('%y-%M-%d %w'));}
window[_leaveCalendarName].config.range.end=new Date().dateAdd("d",90).format('%y-%M-%d');var _query=$('#'+queryId);_query.bind('click',function(event){event.stopPropagation();var mallId=_mallSelectId.val();var fromCity=$.trim(_fromCity.val());var toCity=$.trim(_toCity.val());var fromCityCode=JIFEN_TRIP.Data.getCityCode(fromCity,4,mallId);if(fromCityCode)fromCityCode=fromCityCode[1].toLowerCase();var toCityCode=JIFEN_TRIP.Data.getCityCode(toCity,4,mallId);if(toCityCode)toCityCode=toCityCode[1].toLowerCase();if(fromCity==''||fromCity==cityDefaultValue){_fromCity.click();return;}else if(toCity==''||toCity==cityDefaultValue){_toCity.click();return;}else if(fromCity==toCity){_toCity.click();return;}
var date=_leaveDate.val().split(' ');gTrainOption.date=date[0];setTimeout(function(){$.getJSON(JIFEN.gPrefixHost+'/trip/cb_session_cmd.php?callback=?',{cmd:'in',iType:5,from:fromCity,to:toCity,begdate:gTrainOption.date,mall:10291},function(data){});},0);var queryString="http://caibei.tieyou.com/list/"+fromCityCode+"-"+toCityCode+".html?date="+gTrainOption.date;queryString=encodeURIComponent(queryString);queryString="http://fanli.qq.com/redirect.php?attach=100.1051.05.000.00&mall_id=10291&forcelogin=1&login_type=1&toURL="+queryString;$('#'+queryId).attr({'href':queryString,'target':'_blank'});return true;});}
JIFEN_TRIP.trainBind.counter=0;JIFEN_TRIP.City=function(inputId,varName,flag,defaultValue,isShowNotFind,cityclickcallback,domType,spiObj){this._flag=flag||0;this.isShowNotFind=isShowNotFind||1;this._inputId=inputId;this._input=null;this._varName=varName;this._prefix=this._varName;this._cityPannel=null;this._cityDropdown=null;this._cityTabList;this._cityList;this._hotCityList;this._hasInitialed=false;this._isInput=false;this._defaultValue=defaultValue?defaultValue:'中文｜拼音｜首字母';this._domType=domType||1;var spiObj=spiObj||{};for(var k in spiObj){this["_"+k]=spiObj[k];}
this.init({onClickCity:cityclickcallback||null});};JIFEN_TRIP.City.prototype.init=function(params){if(!params){params={};}
this.remove();if(this._inputId==''||$('#'+this._inputId).length<=0||this._varName==''){return;}
this._input=$('#'+this._inputId);if(params['cityTabList']){this._cityTabList=params['_cityTabList'];}else{this._cityTabList=JIFEN_TRIP.Data.getFlightCityTabList();}
if(params['cityList']){this._cityList=params['cityList'];}else{}
if(params['hotCityList']){this._hotCityList=params['hotCityList'];}else{this._hotCityList=JIFEN_TRIP.Data.getHotCityList();}
if(params['onClickCity']&&typeof(params['onClickCity'])=='function'){this.onChooseCity=params['onClickCity'];}else{this.onChooseCity=this._onChooseCity;}
this._addFrame();this._bind();this._setDefaultValue('init');this._hasInitialed=true;};JIFEN_TRIP.City.prototype._addFrame=function(){var pannelHtml='<div id="'+this._prefix+'_cityPannel" class="mod_city city_ticket" style="display:none;z-index:9999"><p class="title">可直接输入城市或城市拼音 <a class="ico_gb ico_close" href="javascript:void(0)" onclick="'+this._varName+'.hide()">关闭</a></p><ul id="'+this._prefix+'_cityTab" class="city_tab clearfix"></ul><ul id="'+this._prefix+'_cityList" class="city_list clearfix" style="height:160px;overflow-y:auto;"></ul></div>';$('body').append(pannelHtml);this._cityPannel=$('#'+this._prefix+'_cityPannel');var dropdownHtml='<div><ul class="mod_citykeyword" id="'+this._prefix+'_cityDropdown"></ul></div>';$('body').append(dropdownHtml);this._cityDropdown=$('#'+this._prefix+'_cityDropdown');};JIFEN_TRIP.City.prototype.setPosition=function(ob){var inputPos=this._input.offset();var inputHeight=this._input.height();var x,y;if($.browser.msie){x=inputPos.left;y=inputPos.top;}else{x=inputPos.left;y=inputPos.top;}
if(this._domType==2){x=x-this._cityPannel.width()+this._input.width()-9;}
if(ob=='pannel'){if(window.location.href.indexOf("trip")==-1&&window.location.href.indexOf("use_jifen_cash.html")==-1){x=x+this._input.width()-this._cityPannel.width()-20;}
this._cityPannel.offset({left:x,top:(y+inputHeight)});}else if(ob=='dropdown'){this._cityDropdown.offset({left:x,top:(y+inputHeight)});}};JIFEN_TRIP.City.prototype._bind=function(){var _self=this;if(this._domType==1){this._input.bind("click",function(event){_self._input.attr("autocomplete","off");_self._setDefaultValue('click');_self.showPannel('hot');event.stopPropagation();});this._input.bind("blur",function(event){_self._input.attr("autocomplete","");_self._setDefaultValue('blur');});this._input.bind("keyup",function(event){_self._inputEvent(event,"keyup");});this._input.bind("keydown",function(event){_self._inputEvent(event,"keydown");});}
if(this._domType==2){this._input.bind("click",function(event){_self._input.attr("autocomplete","off");_self._setDefaultValue('click');_self.showPannel('hot');event.stopPropagation();});}
this._cityPannel.bind('click',function(event){event.stopPropagation();});this._cityDropdown.bind("mouseover",function(event){_self._dropdownMouseOver(event);});$(document).bind('click',function(){if($.browser.msie&&parseInt($.browser.version)<7){showSelect('ticket_select','price_select','hotel_mall','vacation_mall','price_select_hk','hotel_mall_hk','train_mall','iticket_select');}
_self.hide();});};JIFEN_TRIP.City.prototype._dropdownMouseOver=function(event){var target=event.srcElement||event.target;target=$(target);var parent=target.parent(target);if(parent.length>0){var curretNode=this._cityDropdown.find('li.current');curretNode.removeClass('current');parent.addClass('current');}};JIFEN_TRIP.City.prototype._inputEvent=function(event,type){var keyCode=event.keyCode;if(keyCode==229){this._isInput=true;return;}else{this._isInput=false;}
if(type=='keyup'){if(keyCode==38||keyCode==40){}else if(keyCode==9||keyCode==13){this._dropdownKeyBoard(keyCode);}else{this.showDropdown();}}else if(type=='keydown'){if(keyCode==38||keyCode==40){this._dropdownKeyBoard(keyCode);}}};JIFEN_TRIP.City.prototype.showPannel=function(tabKey){if(!this._hasInitialed){this.init();}
this._cityDropdown.hide();var tabHtml=[];for(var key in this._cityTabList){var item=this._cityTabList[key];var classAttr;if(key==tabKey){classAttr='class="current"';}else{classAttr='';}
tabHtml.push('<li id="'+this._prefix+'_'+key+'" onclick="'+this._varName+'.showPannel(\''+key+'\')"'+classAttr+'><a href="javascript:void(0)">'+item[2]+'</a></li>');}
$('#'+this._prefix+'_cityTab').html(tabHtml.join(''));var listHtml=[],cityList;if(tabKey=='hot'){if(this._isUse&&this._dataType&&this._hotcity){cityList=this._hotcity;}
else{cityList=JIFEN_TRIP.Data.getHotCityList();}
var itemName;for(var key in cityList){var item=cityList[key];itemName=item[0].length>4?(item[0].substr(0,4)+'..'):item[0];listHtml.push('<li onclick="'+this._varName+'.onChooseCity(\''+key+'\',\''+itemName+'\')"><a title="'+item[0]+'" href="javascript:void(0)">'+itemName+'</a></li>');}}else{if(this._isUse&&this._dataType){if(this._dataType=="flight"){cityList=JIFEN_TRIP.Data.getCityList("ctrip");}
else{cityList=this._data;}}
else{if(this._flag==0){var mallId=$("#ticket_select")?$("#ticket_select").val():'goldenholiday';cityList=JIFEN_TRIP.Data.getCityList(mallId);}
else if(this._flag==1){var mallId=$("#hotel_mall")?$("#hotel_mall").val():'ctrip';cityList=JIFEN_TRIP.Data.getCityList(mallId,1);}
else if(this._flag==2){var mallId=$("#vacation_mall")?$("#vacation_mall").val():'mangocity';cityList=JIFEN_TRIP.Data.getCityList(mallId,2).from;}
else if(this._flag==3){var mallId=$("#vacation_mall")?$("#vacation_mall").val():'mangocity';cityList=JIFEN_TRIP.Data.getCityList(mallId,2).to;}
else if(this._flag==4){var mallId=$("#train_mall")?$("#train_mall").val():'tieyou_cb';cityList=JIFEN_TRIP.Data.getCityList(mallId,4);}}
for(var key in cityList){var item=cityList[key];var tabItem=this._cityTabList[tabKey],itemName;var capital=item[1].toLowerCase().substr(0,1);if(capital>=tabItem[0]&&capital<=tabItem[1]){itemName=item[0].length>4?(item[0].substr(0,4)+'..'):item[0];listHtml.push('<li onclick="'+this._varName+'.onChooseCity(\''+key+'\',\''+item[0]+'\')"><a href="javascript:void(0)" title="'+item[0]+'">'+itemName+'</a></li>');}}}
$('#'+this._prefix+'_cityList').html(listHtml.join(''));this._cityPannel.css('display','block');if(this._domType==2){this._cityPannel.find('p').hide();}
this.setPosition('pannel');};JIFEN_TRIP.City.prototype.showDropdown=function(){this._cityPannel.hide();var keywords=$.trim(this._input.val());var dropdownList=[],cityList;if(!keywords){cityList=this._hotCityList;for(var key in cityList){var item=cityList[key];dropdownList.push([key,item[0]+'('+item[1]+')']);}}else if(keywords.charCodeAt(0)<0x007f){if(this._flag==0){var mallId=$("#ticket_select")?$("#ticket_select").val():'goldenholiday';cityList=JIFEN_TRIP.Data.getCityList(mallId);}
else if(this._flag==1){var mallId=$("#hotel_mall")?$("#hotel_mall").val():'ctrip';cityList=JIFEN_TRIP.Data.getCityList(mallId,1);}
else if(this._flag==2){cityList=JIFEN_TRIP.Data.getCityList('mangocity',2).from;}
else if(this._flag==3){cityList=JIFEN_TRIP.Data.getCityList('mangocity',2).to;}
else if(this._flag==4){var mallId=$("#train_mall")?$("#train_mall").val():'tieyou_cb';cityList=JIFEN_TRIP.Data.getCityList(mallId,4);}
var dw_1=[];var dw_2=[];var dw_3=[];for(var key in cityList){var item=cityList[key];var pos;var tkeywords=keywords.toLowerCase();if(item[2]&&item[2].toLowerCase()==tkeywords){dw_1.push([key,item[0]+'(<span>'+item[2]+'</span>)']);}else if(key.toLowerCase()==tkeywords){dw_1.push([key,item[0]+'(<span>'+key+'</span>)']);}else if(item[1].toLowerCase().indexOf(tkeywords)!=-1){pos=item[1].toLowerCase().indexOf(tkeywords);var content=[key,item[0]+'('+item[1].substr(0,pos)+'<span>'+item[1].substr(pos,keywords.length)+'</span>'+item[1].substr(pos+keywords.length)+')'];if(pos==0){dw_2.push(content);}else{dw_3.push(content);}}}
dropdownList=[].concat(dw_1,dw_2,dw_3);}else{if(this._flag==0){var mallId=$("#ticket_select")?$("#ticket_select").val():'goldenholiday';cityList=JIFEN_TRIP.Data.getCityList(mallId);}
else if(this._flag==1){var mallId=$("#hotel_mall")?$("#hotel_mall").val():'ctrip';cityList=JIFEN_TRIP.Data.getCityList(mallId,1);}
else if(this._flag==2){cityList=JIFEN_TRIP.Data.getCityList('mangocity',2).from;}
else if(this._flag==3){cityList=JIFEN_TRIP.Data.getCityList('mangocity',2).to;}
else if(this._flag==4){var mallId=$("#train_mall")?$("#train_mall").val():'tieyou_cb';cityList=JIFEN_TRIP.Data.getCityList(mallId,4);}
for(var key in cityList){var item=cityList[key];var pos=item[0].indexOf(keywords);if(pos!=-1){dropdownList.push([key,item[0].substr(0,pos)+'<span>'+keywords+'</span>'+item[0].substr(pos+keywords.length)+'('+item[1]+')']);}}}
var listHtml=[];var length=dropdownList.length;if(length==0){if(this.isShowNotFind){listHtml.push('<li class="current"><a href="javascript:void(0)">对不起，未找到:<span>'+keywords+'</span></a></li>');}
else{listHtml.push('<li onclick="'+this._varName+'.onChooseCity(\''+keywords+'\')" class="current"><a href="javascript:void(0)">'+keywords+'</a></li>');}}else{var classAttr;var counter=0;for(var i=0;i<length;i++){counter++;if(i==0){classAttr='class="current"';}else{classAttr='';}
if(counter<10){listHtml.push('<li onclick="'+this._varName+'.onChooseCity(\''+dropdownList[i][0]+'\')"'+classAttr+'><a href="javascript:void(0)">'+dropdownList[i][1]+'</a></li>');}
else{listHtml.push('<li style="display:none" onclick="'+this._varName+'.onChooseCity(\''+dropdownList[i][0]+'\')"'+classAttr+'><a href="javascript:void(0)">'+dropdownList[i][1]+'</a></li>');}}}
$('#'+this._prefix+'_cityDropdown').html(listHtml.join(''));this._cityDropdown.show();this.setPosition('dropdown');};JIFEN_TRIP.City.prototype._dropdownKeyBoard=function(keyCode){var curretNode=this._cityDropdown.find('li.current');if(curretNode.length<=0){return;}
if(keyCode==38){var preNode=curretNode.prev();if(preNode.length>0){curretNode.removeClass('current');preNode.addClass('current');}}else if(keyCode==40){var nextNode=curretNode.next();if(nextNode.length>0){curretNode.removeClass('current');nextNode.addClass('current');}}else if(keyCode==13){curretNode.click();}else if(keyCode==9){curretNode.click();}};JIFEN_TRIP.City.prototype._onChooseCity=function(cityCode){if($.browser.msie&&parseInt($.browser.version)<7){if($('#flight_usr_city').length){$('select').show();}
else{showSelect('ticket_select','price_select','hotel_mall','vacation_mall','price_select_hk','hotel_mall_hk','train_mall','iticket_select');}}
if(this._flag==0){var mallId=$("#ticket_select")?$("#ticket_select").val():'goldenholiday';var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);}
else if(this._flag==1){var mallId=$("#hotel_mall")?$("#hotel_mall").val():'ctrip';var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);if(city.length==0){var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);}}
else if(this._flag==2){var mallId=$("#vacation_mall")?$("#vacation_mall").val():'mangocity';var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);}
else if(this._flag==3){var mallId=$("#vacation_mall")?$("#vacation_mall").val():'mangocity';var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);}
else if(this._flag==4){var mallId=$("#train_mall")?$("#train_mall").val():'tieyou_cb';var city=JIFEN_TRIP.Data.getCity(cityCode,this._flag,mallId);}
else{}
if(city[0]){this._input.val(city[0]);}
else{this._input.val(cityCode);}
this.hide();};JIFEN_TRIP.City.prototype._setDefaultValue=function(type){if(type=='init'){this._input.val(this._defaultValue);}else if(type=='click'){if(this._input.val()==this._defaultValue){this._input.val('');}}else if(type=='blur'){if($.trim(this._input.val())==''){this._input.val(this._defaultValue);}}};JIFEN_TRIP.City.prototype.hide=function(){this._cityPannel.hide();this._cityDropdown.hide();};JIFEN_TRIP.City.prototype.remove=function(){if(this._cityDropdown){this._cityDropdown.remove();}
if(this._cityPannel){this._cityPannel.remove();}};Date.prototype.format=function(fmt,isFill){var year=""+this.getFullYear();var month=""+(this.getMonth()+1);var date=""+this.getDate();var hour=""+this.getHours();var minute=""+this.getMinutes();var second=""+this.getSeconds();var miSec=""+this.getMilliseconds();var day=this.getDay();var cn_weeks=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];var cn_weeks_abbr=["日","一","二","三","四","五","六"];var en_weeks=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var en_weeks_abbr=["Sun.","Mon.","Tues.","Wed.","Thur.","Fri.","Sat."];isFill=typeof(isFill)=="boolean"?isFill:true;fmt=fmt||"%y%M%d%h%m%s%i %w";fmt=fmt.replace("%y",year);fmt=fmt.replace("%M",isFill?month.fillBefore("0",2):month);fmt=fmt.replace("%d",isFill?date.fillBefore("0",2):date);fmt=fmt.replace("%h",isFill?hour.fillBefore("0",2):hour);fmt=fmt.replace("%m",isFill?minute.fillBefore("0",2):minute);fmt=fmt.replace("%s",isFill?second.fillBefore("0",2):second);fmt=fmt.replace("%i",isFill?miSec.fillBefore("0",3):miSec);fmt=fmt.replace("%w",cn_weeks[day]);fmt=fmt.replace("%W",en_weeks[day]);fmt=fmt.replace("%a",cn_weeks_abbr[day]);fmt=fmt.replace("%A",en_weeks_abbr[day]);return fmt;};Date.prototype.parseDate=function(str,fmt){return this.validDate(str,fmt).date;};Date.prototype.validDate=function(str,fmt){var tmp="";fmt=fmt||"%y%M%d%h%m%s";tmp=fmt;fmt=fmt.replace("%y","(\\d{4})");fmt=fmt.replace("%M","(\\d{1,2})");fmt=fmt.replace("%d","(\\d{1,2})");fmt=fmt.replace("%h","(\\d{1,2})");fmt=fmt.replace("%m","(\\d{1,2})");fmt=fmt.replace("%s","(\\d{1,2})");fmt=fmt.replace("%i","(\\d{1,3})");fmt=fmt.replace("%w","(星期[日|一|二|三|四|五|六])");fmt=fmt.replace("%W","(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)");fmt=fmt.replace("%a","(日|一|二|三|四|五|六)");fmt=fmt.replace("%A","(Sun\\.|Mon\\.|Tues\\.|Wed\\.|Thur\\.|Fri\\.|Sat\\.)");var regExp=new RegExp("^"+fmt+"$");var group=regExp.exec(str);var _year,_month,_date,_hour,_minute,_second,_millisecond;var yIndex=getIndex("y",tmp);var MIndex=getIndex("M",tmp);var dIndex=getIndex("d",tmp);var hIndex=getIndex("h",tmp);var mIndex=getIndex("m",tmp);var sIndex=getIndex("s",tmp);var iIndex=getIndex("i",tmp);var isUndefined=(undefined===yIndex&&undefined===MIndex&&undefined===dIndex&&undefined===hIndex&&undefined===mIndex&&undefined===sIndex&&undefined===iIndex);var _is=false;var d=new Date();if(null!=group){group.shift();_year=undefined===yIndex?d.getFullYear():parse(group[yIndex]);_month=undefined===MIndex?d.getMonth():parse(group[MIndex])-1;_date=undefined===dIndex?d.getDate():parse(group[dIndex]);_hour=undefined===hIndex?d.getHours():parse(group[hIndex]);_minute=undefined===mIndex?d.getMinutes():parse(group[mIndex]);_second=undefined===sIndex?d.getSeconds():parse(group[sIndex]);_millisecond=undefined===iIndex?d.getMilliseconds():parse(group[iIndex]);d=new Date(_year,_month,_date,_hour,_minute,_second,_millisecond);_is=(false===isUndefined)&&((d.getFullYear()===_year)&&(d.getMonth()===_month)&&(d.getDate()===_date)&&(d.getHours()===_hour)&&(d.getMinutes()===_minute)&&(d.getSeconds()===_second)&&(d.getMilliseconds()===_millisecond));}
function parse(v){return typeof(v)=="undefined"?0:parseInt(v,10);}
function getIndex(flag,fmt){var tmp=fmt.replace(/[^%yMdhmsi]+/g,"");var arr=tmp.split("%");var size=arr.length;for(var i=1;i<size;i++){if(arr[i]==flag){return(i-1);}}
return undefined;}
return{isValid:_is,date:d};};Date.prototype.leapYear=function(){var _days=new Array(31,28,31,30,31,30,31,31,30,31,30,31);var _is=false;var _d=365;if((this.getFullYear()%4==0&&this.getFullYear()%100!=0)||this.getFullYear()%400==0){_days.splice(1,1,29);_is=true;_d=366;}else{_days.splice(1,1,28);_is=false;_d=365;}
return{isLeapYear:_is,days:_days,yearDays:_d,monthDays:_days[this.getMonth()]};};Date.prototype.dateDiff=function(interval,date){var diff=0;switch(interval){case'y':diff=date.getFullYear()-this.getFullYear();break;case'q':diff=((date.getMonth()+1)+((date.getFullYear()-this.getFullYear())*12)-(this.getMonth()+1))/3;break;case'n':diff=(date.getMonth()+1)+((date.getFullYear()-this.getFullYear())*12)-(this.getMonth()+1);break;case'd':diff=(date-this)/86400000;break;case'w':diff=(date-this)/(86400000*7);break;case'h':diff=(date-this)/3600000;break;case'm':diff=(date-this)/60000;break;case's':diff=(date-this)/1000;break;case'i':diff=date.getTime()-this.getTime();break;default:diff=date.getTime()-this.getTime();break;}
return diff;};Date.prototype.dateAdd=function(interval,num){switch(interval){case'y':this.setFullYear(this.getFullYear()+num);break;case'q':this.setMonth(this.getMonth()+(num*3));break;case'n':this.setMonth(this.getMonth()+num);break;case'd':this.setDate(this.getDate()+num);break;case'w':this.setDate(this.getDate()+(num*7));break;case'h':this.setHours(this.getHours()+num);break;case'm':this.setMinutes(this.getMinutes()+num);break;case's':this.setSeconds(this.getSeconds()+num);break;case'i':this.setMilliseconds(this.getMilliseconds()+num);break;default:this.setMilliseconds(this.getMilliseconds()+num);break;}
return this;};String.prototype.fillBefore=function(chr,bit){var len=this.length;var shift=bit-len+1;var str=this;if(shift>0){var a=new Array(shift);str=a.join(chr)+str;a=null;}
return str;};String.prototype.leftTrim=function(){var pattern=/^[\s ]/gmi;var tmp=this.replace(pattern,"");pattern=null;return tmp;};String.prototype.rightTrim=function(){var pattern=/[\s ]$/gmi;var tmp=this.replace(pattern,"");pattern=null;return tmp;};String.prototype.bothTrim=function(){return(this.leftTrim()).rightTrim();};function Calendar(){this.PREFIX="CALENDAR_";this.SECURE_PAGE=$.browser.msie?"javascript:''":"about:blank";this.WIDTH=175;this.HEIGHT=200;this.WEEKDAYS={"Sunday":{en_abbr:"Sun.",abbr:"日",full:"星期日"},"Monday":{en_abbr:"Mon.",abbr:"一",full:"星期一"},"Tuesday":{en_abbr:"Tues.",abbr:"二",full:"星期二"},"Wednesday":{en_abbr:"Wed.",abbr:"三",full:"星期三"},"Thursday":{en_abbr:"Thur.",abbr:"四",full:"星期四"},"Friday":{en_abbr:"Fri.",abbr:"五",full:"星期五"},"Saturday":{en_abbr:"Sat.",abbr:"六",full:"星期六"}};this.MONTHS=[{en:"january",text:"一",value:"01"},{en:"february",text:"二",value:"02"},{en:"march",text:"三",value:"03"},{en:"april",text:"四",value:"04"},{en:"may",text:"五",value:"05"},{en:"june",text:"六",value:"06"},{en:"july",text:"七",value:"07"},{en:"august",text:"八",value:"08"},{en:"september",text:"九",value:"09"},{en:"october",text:"十",value:"10"},{en:"november",text:"十一",value:"11"},{en:"december",text:"十二",value:"12"}];this.config={id:0,size:1,rows:1,cols:1,showToday:false,initDate:(new Date()).format('%y-%M-%d'),namespace:'cal',range:{start:null,end:null,disabled:false},bind:[],offsetX:0,offsetY:0,bindNext:true,format:'%y-%M-%d'};this.def_date=new Date();this.previous_list=null;this.isMultiple=false;this.index=0;};Calendar.prototype={init:function(cfg){var conf=cfg||null;for(var key in conf){if(conf.hasOwnProperty(key)){this.config[key]=conf[key];}}
this.isMultiple=(this.config["size"]>1);this.setCalendarCSS();this.bindCalendar();},getPosition:function(ref){refEl=$(ref);var position=refEl.offset();var height=refEl.height();var width=refEl.width()
return{x:position.left,y:position.top,w:width,h:height};},createIframe:function(){var ifr=document.createElement("iframe");var cfg=this.config;var _id=this.PREFIX+"iframe_"+cfg.id;var _url=this.SECURE_PAGE;var attrs={frameBorder:0,vSpacing:0,hSpacing:0,marginWidth:0,marginHeight:0,scrolling:'no',src:_url,id:_id};var _width=cfg.cols*this.WIDTH;var _height=cfg.rows*this.HEIGHT;for(var attr in attrs){if(attrs.hasOwnProperty(attr)){ifr.setAttribute(attr,attrs[attr]);}}
ifr.style.cssText="width:"+_width+"px; height:"+_height+"px; position:absolute; z-index:-1; left:0px; top:0px;";return ifr;},createPanel:function(refNode,offsetX,offsetY){var cfg=this.config;var _id=this.PREFIX+"panel_"+cfg.id;var _calId=this.PREFIX+"calendar_"+cfg.id;var _width=cfg.cols*this.WIDTH;var _height=cfg.rows*this.HEIGHT;if(!cfg.showToday){_height=cfg.rows*(this.HEIGHT-25);}
var panel=document.getElementById(_id);var ifr=null;var cal=null;var pos=null;var _this=this;pos=this.getPosition(refNode);var postionLeft=pos.x+offsetX;if(window.location.href.indexOf('index.html')==-1){postionLeft=pos.x+pos.w-_width+4+offsetX;}
if(null==panel){cal=document.createElement("div");cal.setAttribute("id",_calId);panel=document.createElement("div");panel.setAttribute("id",_id);panel.style.cssText="position:absolute; left:"+postionLeft+"px; top:"+(pos.y+offsetY)+"px; z-index:4000; width:"+_width+"px; height:"+_height+"px; display:none;";panel.className="cal-panel";if($.browser.msie&&parseInt($.browser.version)<7){ifr=this.createIframe();panel.appendChild(ifr);}
panel.appendChild(cal);document.body.appendChild(panel);if(document.addEventListener){panel.addEventListener("mouseup",function(event){event.preventDefault();event.stopPropagation();},false);}else{panel.attachEvent("onmouseup",function(){window.event.returnValue=!(window.event.cancelBubble=true);});}
cal.onmouseup=function(event){var e=event||window.event;var obj=e.target||e.srcElement;var tagName=(obj.tagName).toLowerCase();var cls=(obj.className).toLowerCase();if("span"!=tagName||"code"!=tagName||"cal-down"!=cls){_this.hidePreviousList();}};}
panel.style.cssText="position:absolute; left:"+postionLeft+"px; top:"+(pos.y+offsetY)+"px; z-index:4000; width:"+_width+"px; height:"+_height+"px; display:none;";this.clearHistoryCalendar(_calId);return{"panel":panel,"calendar":cal};},clearHistoryCalendar:function(calId){var cal=document.getElementById(calId);cal.innerHTML="";},createTable:function(row,col){var cfg=this.config;var _id=this.PREFIX+"table_"+cfg.id+"_"+row+"_"+col;var divId=this.PREFIX+"div_"+cfg.id+"_"+row+"_"+col;var div=document.createElement("div");var table=document.createElement("table");var tbody=document.createElement("tbody");var attrs={id:_id,border:0,cellpadding:0,cellspacing:0};div.className="cal-calendar-p";table.className="cal-calendar";tbody.className="cal-body";div.setAttribute("id",divId);for(var attr in attrs){if(attrs.hasOwnProperty(attr)){table.setAttribute(attr,attrs[attr]);}}
table.appendChild(tbody);div.appendChild(table);return{t:table,b:tbody,p:div};},changeCalendar:function(row,col,format,interval,offset){var cfg=this.config;var _id=this.PREFIX+"panel_"+cfg.id;var month_id=this.PREFIX+"month_"+cfg.id+"_"+row+"_"+col;var year_id=this.PREFIX+"year_"+cfg.id+"_"+row+"_"+col;var panel=document.getElementById(_id);var month=document.getElementById(month_id);var year=document.getElementById(year_id);var date=new Date()
var dtStr=year.innerHTML+"-"+month.getAttribute("month")+"-01";date=date.parseDate(dtStr,format);if(offset!=0){date=date.dateAdd(interval,offset);}
this.clearHistoryCalendar(this.PREFIX+"calendar_"+cfg.id);this.createCalendar(panel,date,format);panel=null;year=null;month=null;date=null;},keyEvent:function(event,row,col,format,interval,offset){var keyCode=event&&event.button?event.button:window.event.keyCode;if(13==keyCode){this.changeCalendar(row,col,format,interval,offset);}},hidePreviousList:function(){if(null!=this.previous_list){this.hideMonthList(this.previous_list.replace("year","month"));this.hideYearList(this.previous_list.replace("month","year"));this.previous_list=null;}},getMonthList:function(iMonth,row,col,format){var cfg=this.config;var months=this.MONTHS;var size=months.length;var str="";var item=null;var start=iMonth;var end=start+8;var str='<div class="cal-pre-date" onclick="'+cfg.namespace+'.turnMonth(0, \''+row+'\', \''+col+'\', \''+format+'\')"></div>';for(var i=start;i<size&&i<end;i++){item=months[i];str+='<div class="cal-list-month" onmouseover="this.className=\'cal-list-month-hovr\'" onmouseout="this.className=\'cal-list-month\'" onclick="'+cfg.namespace+'.setCheckedMonth(\''+item.value+'\', \''+item.text+'\', \''+row+'\', \''+col+'\', \''+format+'\')">'+item.value+'月</div>';}
str+='<div class="cal-next-date" onclick="'+cfg.namespace+'.turnMonth(4, \''+row+'\', \''+col+'\', \''+format+'\')"></div>';return str;},turnMonth:function(iMonth,row,col,format){var cfg=this.config;var month_id=this.PREFIX+"month_"+cfg.id+"_"+row+"_"+col;var month_list_id=this.PREFIX+"month_list_"+cfg.id+"_"+row+"_"+col;var list=document.getElementById(month_list_id);list.innerHTML=this.getMonthList(iMonth,row,col,format);list=null;},setCheckedMonth:function(sMonth,sText,row,col,format){var cfg=this.config;var month_id=this.PREFIX+"month_"+cfg.id+"_"+row+"_"+col;var month_list_id=this.PREFIX+"month_list_"+cfg.id+"_"+row+"_"+col;var month=document.getElementById(month_id);var list=document.getElementById(month_list_id);month.innerHTML=sMonth;month.setAttribute("month",sMonth);this.changeCalendar(row,col,format,'y',0);list.style.display="none";month=null;list=null;},stopEventBubble:function(obj){if(document.addEventListener){obj.addEventListener("mouseup",function(event){event.preventDefault();event.stopPropagation();},false);}else{obj.attachEvent("onmouseup",function(){window.event.returnValue=!(window.event.cancelBubble=true);});}},showMonthList:function(obj,row,col,format,monthId,monthListId){var list=document.getElementById(monthListId);list.innerHTML=this.getMonthList(0,row,col,format);list.style.display="block";list=null;this.hidePreviousList();this.hideYearList(monthListId.replace("month","year"));this.previous_list=monthListId;},hideMonthList:function(monthListId){var list=document.getElementById(monthListId);list.style.display="none";},getYearList:function(iYear,row,col,format){var cfg=this.config;var end=iYear+8;var str='<div class="cal-pre-date" onclick="'+cfg.namespace+'.turnYear('+(iYear-7)+', \''+row+'\', \''+col+'\', \''+format+'\')"></div>';for(var i=iYear;i<end;i++){str+='<div class="cal-list-year" onmouseover="this.className=\'cal-list-year-hovr\'" onmouseout="this.className=\'cal-list-year\'" onclick="'+cfg.namespace+'.setCheckedYear('+i+', \''+row+'\', \''+col+'\', \''+format+'\')">'+i+'年</div>';}
str+='<div class="cal-next-date" onclick="'+cfg.namespace+'.turnYear('+end+', \''+row+'\', \''+col+'\', \''+format+'\')"></div>';return str;},setCheckedYear:function(iYear,row,col,format){var cfg=this.config;var year_id=this.PREFIX+"year_"+cfg.id+"_"+row+"_"+col;var year_list_id=this.PREFIX+"year_list_"+cfg.id+"_"+row+"_"+col;var year=document.getElementById(year_id);var list=document.getElementById(year_list_id);year.innerHTML=iYear;this.changeCalendar(row,col,format,'y',0);list.style.display="none";year=null;list=null;},turnYear:function(iYear,row,col,format){if(iYear<1900){iYear=1900;}
if(iYear>2093){iYear=2093;}
var cfg=this.config;var year_id=this.PREFIX+"year_"+cfg.id+"_"+row+"_"+col;var year_list_id=this.PREFIX+"year_list_"+cfg.id+"_"+row+"_"+col;var list=document.getElementById(year_list_id);list.innerHTML=this.getYearList(iYear,row,col,format);list=null;},showYearList:function(obj,row,col,format,yearId,yearListId){var year=document.getElementById(yearId);var list=document.getElementById(yearListId);var iYear=year.innerHTML*1;list.innerHTML=this.getYearList(iYear,row,col,format);list.style.display="block";year=null;list=null;this.hidePreviousList();this.hideMonthList(yearListId.replace("year","month"));this.previous_list=yearListId;},hideYearList:function(yearListId){var list=document.getElementById(yearListId);list.style.display="none";},createHead:function(table,row,col,format){var cfg=this.config;var _id=this.PREFIX+"head_"+cfg.id+"_"+row+"_"+col;var month_id=this.PREFIX+"month_"+cfg.id+"_"+row+"_"+col;var year_id=this.PREFIX+"year_"+cfg.id+"_"+row+"_"+col;var month_list_id=this.PREFIX+"month_list_"+cfg.id+"_"+row+"_"+col;var year_list_id=this.PREFIX+"year_list_"+cfg.id+"_"+row+"_"+col;var thead=table.createTHead();var tr=thead.insertRow(-1);var td=tr.insertCell(-1);var pre=(0===row+col)?'<em title="上一个月" class="cal-btn-month cal-btn-pre-month" onclick="'+cfg.namespace+'.changeCalendar(\''+row+'\', \''+col+'\', \''+format+'\', \'n\', '+(-1*cfg.size)+')"></em>':'';var next=(cfg.size==(row+1)*(col+1))?'<em title="下一个月" class="cal-btn-month cal-btn-next-month" onclick="'+cfg.namespace+'.changeCalendar(\''+row+'\', \''+col+'\', \''+format+'\', \'n\', 1)"></em>':'';thead.setAttribute("id",_id);thead.className="cal-head";td.colSpan=7;td.align="right";td.innerHTML=pre+'<span style="width:50%;text-align:right;" onclick="'+cfg.namespace+'.showYearList(this, \''+row+'\', \''+col+'\', \''+format+'\', \''+year_id+'\', \''+year_list_id+'\')"><code id="'+year_id+'"></code>年<em class="cal-down"></em></span><span onclick="'+cfg.namespace+'.showMonthList(this, \''+row+'\', \''+col+'\', \''+format+'\', \''+month_id+'\', \''
+month_list_id+'\')"><code id="'+month_id+'"></code>月<em class="cal-down"></em></span>'+next+'<div onmouseup="'+cfg.namespace+'.stopEventBubble(this)" id="'+year_list_id+'" class="cal-year-list" style="display:none;"></div><div onmouseup="'+cfg.namespace+'.stopEventBubble(this)" id="'+month_list_id+'" class="cal-month-list" style="display:none;"></div>';table=null;thead=null;tr=null;td=null;},createFoot:function(table,row,col){var cfg=this.config;var _id=this.PREFIX+"head_"+cfg.id+"_"+row+"_"+col;var tfoot=table.createTFoot();var tr=tfoot.insertRow(-1);var td=tr.insertCell(-1);tfoot.setAttribute("id",_id);tfoot.className="cal-foot";td.colSpan=7;td.innerHTML='<button title="'+((new Date()).format("%y-%M-%d, %w"))+'" type="button" onclick="'+cfg.namespace+'.clickEvent()">今天</button>';table=null;tfoot=null;tr=null;td=null;},setCurrentDate:function(date,row,col){var cfg=this.config;var month_id=this.PREFIX+"month_"+cfg.id+"_"+row+"_"+col;var year_id=this.PREFIX+"year_"+cfg.id+"_"+row+"_"+col;var month=document.getElementById(month_id);var year=document.getElementById(year_id);month.innerHTML=this.MONTHS[date.getMonth()].value;month.setAttribute("month",this.MONTHS[date.getMonth()].value);year.innerHTML=date.getFullYear();},createBody:function(table,row,col,date){var currentDate=new Date(date.getFullYear(),date.getMonth(),1);var firstDay=currentDate.getDay();var leapYear=date.leapYear();var monthDays=leapYear.monthDays;for(var i=0;i<7;i++){if(0==i){this.createWeekDays(table,row,col,i);}else{this.createDate(table,row,col,currentDate,date,i,firstDay,monthDays);}}},createWeekDays:function(table,row,col,i){var cfg=this.config;var _id=this.PREFIX+"tr_weekdays_"+cfg.id+"_"+row+"_"+col+"_"+i;var weekDays=this.WEEKDAYS;var tr=table.insertRow(-1);var td=null;var j=0;tr.className="cal-week";tr.setAttribute("id",_id);for(var key in weekDays){if(weekDays.hasOwnProperty(key)){_id=this.PREFIX+"td_weekdays_"+cfg.id+"_"+row+"_"+col+"_"+i+"_"+j;td=tr.insertCell(-1);td.innerHTML=weekDays[key]["abbr"];td.setAttribute("id",_id);j++;}}
table=null;tr=null;td=null;},createDate:function(table,row,col,currentDate,date,i,firstDay,monthDays){var cfg=this.config;var _id=this.PREFIX+"tr_date_"+cfg.id+"_"+row+"_"+col+"_"+i;var tr=table.insertRow(-1);tr.className="cal-date";tr.setAttribute("id",_id);for(var j=0;j<7;j++){this.createDay(tr,row,col,currentDate,date,i,j,firstDay,monthDays);}},inRange:function(date){var cfg=this.config;var ref=date.format("%y%M%d")*1;var start=cfg.range.start?(new Date().parseDate(cfg.range.start,"%y-%M-%d").format("%y%M%d"))*1:0;var end=cfg.range.end?(new Date().parseDate(cfg.range.end,"%y-%M-%d").format("%y%M%d"))*1:99999999;var flag=false;if(ref>=start&&ref<=end){flag=true;}
return flag;},createDay:function(tr,row,col,currentDate,date,i,j,firstDay,monthDays){var cfg=this.config;var _id=this.PREFIX+"td_date_"+cfg.id+"_"+row+"_"+col+"_"+i+"_"+j;var dis=cfg.range.disabled;var inc=false;var td=tr.insertCell(-1);var index=(i-1)*7+j;var d2=new Date();var d=currentDate.getDate();td.innerHTML="&nbsp;";if(index>=firstDay&&d<=monthDays&&date.getMonth()==currentDate.getMonth()){td.innerHTML=d;td.title=currentDate.format("%y-%M-%d, %w")
inc=this.inRange(currentDate);if(!inc){td.className="cal-disabled";}
if(!dis||inc){this.bindClickEvent(td,new Date(currentDate.getTime()));this.bindMouseEvent(td);if(!inc){td.className="cal-not-in-range";}}
if(currentDate.format("%y%M%d")==d2.format("%y%M%d")){td.className=inc?"cal-current":(dis?"cal-disabled-current":"cal-current");}
if(currentDate.format("%y%M%d")==this.def_date.format("%y%M%d")){td.className=inc?"cal-def-date":(dis?"cal-disabled-current cal-def-date":"cal-def-date");}
currentDate.dateAdd("d",1);}else{td.className="cal-null";}},dispatchEvent:function(target,eventType,datatype,data){var obj=typeof(target)=="object"?target:document.getElementById(target);var e=null;if(document.createEvent){e=document.createEvent("Events");e.initEvent(eventType,true,true);}else if(document.createEventObject){e=document.createEventObject();}else{return false;}
e.datatype=datatype;e.data=data;if(obj.dispatchEvent){obj.dispatchEvent(e);}else if(obj.fireEvent){obj.fireEvent("on"+eventType,e);}},clickEvent:function(currentDate){var cfg=this.config;var next=null;var list=cfg.bind||[];var size=list.length-1;var index=this.index+1;var item=list[this.index];next=size>=index?list[index]:null;currentDate=currentDate||new Date();if(item&&null!=item.handler){item.args.unshift(currentDate);item.handler.apply(null,item.args);item.args.shift();}
this.hide();if(cfg.bindNext&&null!=next){this.dispatchEvent(next.ref,"click",null,null);}},bindClickEvent:function(td,currentDate){var cfg=this.config;var _this=this;td.onclick=function(){_this.clickEvent(currentDate);}},bindMouseEvent:function(td){td.onmouseover=function(){var cls=this.className;cls=cls.replace(/[\s ]*cal\-mover[\s ]*/,"");this.className=cls+" cal-mover";}
td.onmouseout=function(){var cls=this.className;cls=cls.replace(/[\s ]*cal\-mover[\s ]*/,"");this.className=cls;}},createCalendar:function(panel,date,format){var cfg=this.config;var table=null;var rows=cfg.rows;var cols=cfg.cols;var calId=this.PREFIX+"calendar_"+cfg.id;var cal=document.getElementById(calId);for(var row=0;row<rows;row++){for(var col=0;col<cols;col++){table=this.createTable(row,col);this.createHead(table.t,row,col,format);this.createBody(table.b,row,col,date);if(true===cfg.showToday){this.createFoot(table.t,row,col);}else{panel.style.height=rows*(this.HEIGHT-25);}
cal.appendChild(table.p);this.setCurrentDate(date,row,col);date.setDate(1);date=date.dateAdd("n",1);}}
panel.style.display="block";if(document.addEventListener){document.addEventListener("mouseup",function(event){panel.style.display="none";document.removeEventListener("mouseup",arguments.callee,false);},false);}else{document.attachEvent("onmouseup",function(){panel.style.display="none";document.detachEvent("mouseup",arguments.callee);});}},compatible:function(strDate,format){var fmts=["%y%M%d","%y-%M-%d","%y.%M.%d","%y年%M月%d日","%y年%M月%d","%M%d%y","%M-%d-%y","%M.%d.%y","%M月%d日%y年","%M月%d日%y","%d%M%y","%d-%M-%y","%d.%M.%y","%d日%M月%y年","%d日%M月%y","%M/%d, %w","%d/%M, %w","%M/%d, %W","%d/%M, %W","%M/%d, %a","%d/%M, %a","%M/%d, %A","%d/%M, %A"];var size=fmts.length;var valid=null;var date=new Date();var str=strDate;valid=date.validDate(strDate,format);if(!valid.isValid){for(var i=0;i<size;i++){valid=date.validDate(strDate,fmts[i]);if(valid.isValid){date=valid.date;break;}}}else{date=valid.date;}
str=date.format(format);return str;},bindCalendar:function(){var list=this.config.bind||[];var size=list.length;var o=null;var item=null;for(var i=0;i<size;i++){item=list[i];o=document.getElementById(item.ref);if(null!=o){this.setBindEvent(o,item,i);}}},setBindEvent:function(o,item,i){var _this=this;var fmt=this.config.format||"%y-%M-%d";$(o).bind('click',function(){_this.show(o,item.input,_this.config.offsetX,_this.config.offsetY,fmt,i);});},show:function(refNode,inputId,offsetX,offsetY,format,index){this.index=index;var panel=this.createPanel(refNode,offsetX,offsetY);var def=document.getElementById(inputId);var defDate=null!=def?(def.value).bothTrim():"";if(defDate){if(defDate.indexOf(' ')!=-1){defDate=defDate.substr(0,defDate.indexOf(' '));}}else if(this.config.initDate){defDate=this.config.initDate;}
var date=new Date();var fmt=(format||"%y-%M-%d");defDate=this.compatible(defDate,fmt);date=date.parseDate(defDate,fmt);this.def_date=new Date().parseDate(defDate,fmt);this.createCalendar(panel.panel,date,fmt);},hide:function(){var cfg=this.config;var _id=this.PREFIX+"panel_"+cfg.id;var panel=document.getElementById(_id);panel.style.display="none";panel=null;},dynamicStyle:function(cssTexts,suffix){var id="dynamic_style_"+(suffix||(new Date().getTime()));var style=document.getElementById(id);if(null==style){style=document.createElement("style");style.type="text/css";style.rel="stylesheet";style.setAttribute("id",id);document.getElementsByTagName("head")[0].appendChild(style);if($.browser.msie){style.styleSheet.cssText=cssTexts.join("");}else{for(var i=0;i<cssTexts.length;i++){style.sheet.insertRule(cssTexts[i],i);}}}
return style;},setCalendarCSS:function(){var cssTexts=['.cal-panel{font:normal normal normal 12px/16px simsun; overflow:hidden; background:#fff;}','.cal-panel .cal-calendar-p{width:175px; height:auto; position:relative; float:left;}','.cal-panel .cal-calendar{border:#9DB0BC solid 1px; width:175px; height:auto; border-collapse:separate; *border-collapse:collapse;}','.cal-panel .cal-calendar td{padding:0px; margin:0px; border:none;}','.cal-panel .cal-head, .cal-panel .cal-body, .cal-panel .cal-foot{width:100%;}','.cal-panel .cal-head td{border-bottom:#9DB0BC solid 1px; height:28px; vertical-align:middle; text-align:center;}','.cal-panel .cal-head em.cal-btn-month{display:-moz-stack-inline; display:inline-block; zoom:1; *display:inline; padding:0px; margin:0px; width:0px; height:0px; overflow:hidden; border-top:solid 7px #fff; border-bottom:solid 7px #fff; cursor:pointer; vertical-align:middle; position:absolute; top:7px;}','.cal-panel .cal-head em.cal-btn-pre-month{border-right:solid 7px #7c9db1;border-left:none; left:5px;}','.cal-panel .cal-head em.cal-btn-next-month{border-right:none; border-left:solid 7px #7c9db1; right:5px;}','.cal-panel .cal-head span{display:-moz-stack-inline; display:inline-block; zoom:1; *display:inline; width:56px; height:22px; _height:12px; line-height:26px; margin:0px 3px; _padding:2px 0px 0px 0px; cursor:pointer; vertical-align:middle; overflow:hidden;}','.cal-panel .cal-head code{display:inline; margin:0px 2px 0px 0px;}','.cal-panel .cal-head em.cal-down{display:-moz-stack-inline; display:inline-block; zoom:1; *display:inline; margin:0px 0px 0px 2px; width:0px; height:0px; border-left:solid 4px #fff; border-right:solid 4px #fff; border-top:solid 4px #7c9db1;border-bottom:none; cursor:pointer; vertical-align:2px; overflow:hidden;}','.cal-panel .cal-head div.cal-year-list{position:absolute; left:30px; top:22px; border:1px solid #9DB0BC; background:#f8f8f8; width:48px; height:146px;}','.cal-panel .cal-head div.cal-pre-date{width:0px; height:0px; border-left:solid 4px #f8f8f8; border-right:solid 4px #f8f8f8; border-bottom:solid 4px #7c9db1; margin:3px auto; cursor:pointer; overflow:hidden;}','.cal-panel .cal-head div.cal-next-date{width:0px; height:0px; border-left:solid 3px #f8f8f8; border-right:solid 3px #f8f8f8; border-top:solid 3px #7c9db1; margin:3px auto; cursor:pointer; overflow:hidden;}','.cal-panel .cal-head div.cal-list-year{height:16px; line-height:16px; overflow:hidden; cursor:pointer; color:#666;}','.cal-panel .cal-head div.cal-list-year-hovr{height:16px; line-height:16px; overflow:hidden; cursor:pointer; background:#07679C; color:#fff;}','.cal-panel .cal-head div.cal-month-list{position:absolute; left:94px; top:22px; border:1px solid #9DB0BC; background:#f8f8f8; width:48px; height:146px;}','.cal-panel .cal-head div.cal-list-month{height:16px; line-height:16px; overflow:hidden; cursor:pointer; color:#666;}','.cal-panel .cal-head div.cal-list-month-hovr{height:16px; line-height:16px; overflow:hidden; cursor:pointer; background:#07679C; color:#fff;}','.cal-panel .cal-week td{border-bottom:#9DB0BC solid 1px; width:25px; height:20px; text-align:center; color:#333;}','.cal-panel .cal-date td{width:25px; height:20px; text-align:center; color:#07679C; cursor:pointer;}','.cal-panel .cal-date td.cal-null{cursor:default;}','.cal-panel .cal-date td.cal-current{background:#043C59; color:#fff;}','.cal-panel .cal-date td.cal-disabled{color:#999; cursor:default;}','.cal-panel .cal-date td.cal-disabled-current{background:#043C59; color:#fff; cursor:default;}','.cal-panel .cal-date td.cal-not-in-range{color:#999;}','.cal-panel .cal-date td.cal-mover{background:#07679C; color:#fff;}','.cal-panel .cal-date td.cal-def-date{background:#07679C; color:#fff;}','.cal-panel .cal-foot td{border-top:#9DB0BC solid 1px; height:25px; vertical-align:middle; text-align:center;}','.cal-panel .cal-foot button{border:none; background:#fff; font:normal normal normal 12px/16px simsun; color:#333; cursor:pointer;}'];this.dynamicStyle(cssTexts,"calendar_v1.5");}};Calendar.prototype.tripInit=function(id,varName,handler,settings){if($('#'+id).length<=0||varName==''){return;}
if(typeof handler!="function"){handler=function(date){var format=date.format("%y-%M-%d");var nature=JIFEN_TRIP.natureDate(date);if(JIFEN_TRIP.config.isShortFormat()){$('#'+id).val(format);}
else{$('#'+id).val(format+' '+nature);}};}
var input={ref:id,input:id,handler:handler,args:[id]};var defaultSettings={id:0,size:2,rows:1,cols:2,range:{start:new Date().format("%y-%M-%d"),end:null,disabled:true},namespace:varName,bind:[input],offsetX:0,offsetY:20,bindNext:false,showToday:false};for(var key in settings){defaultSettings[key]=settings[key];}
settings=defaultSettings;this.init(settings);};Calendar.getSelectedDate=function(id){var val=$.trim($('#'+id).val());val=val.slice(0,10);return val.replace(/-/g,'');};var JIFEN_TRIP=JIFEN_TRIP||{};JIFEN_TRIP.Calendar=Calendar;var JIFEN_TRIP=JIFEN_TRIP||{};JIFEN_TRIP.Checker=JIFEN_TRIP.Checker||{};JIFEN_TRIP.Checker.isEmail=function(str){var regExp=/^([a-z0-9])+(([a-z0-9])+[\.]?[_]?)*@(([a-z0-9])+[\.]){1,2}[a-z]{2,3}$/i;return regExp.test(str);};JIFEN_TRIP.Checker.isMobile=function(str){var regExp=/^1\d{10}$/;return regExp.test(str);};JIFEN_TRIP.Checker.isTel=function(str){var regExp=/^(0\d{2,3}-)?\d{5,8}(-\d{1,5})?$/;return regExp.test(str);};JIFEN_TRIP.Checker.isName=function(str){var chRegExp=/^[\u4e00-\u9fa5]{1,15}[a-z]*$/i;var enRegExp=/^[a-z]+\/[a-z]+( [a-z]+){0,9}$/i;if(chRegExp.test(str)){if(str.length<2){return false;}else{return true;}}else if(enRegExp.test(str)){return true;}else{return false;}};JIFEN_TRIP.Checker.isUrl=function(str){var regExp=/^https?:\/\/[a-z]+/i;return regExp.test(str);};JIFEN_TRIP.Checker.isZipCode=function(str){var regExp=/^\d{6}$/;return regExp.test(str);};JIFEN_TRIP.Checker.isFreqCard=function(str){var regExp=/^[a-z\d]{3,}$/i;return regExp.test(str);};JIFEN_TRIP.Checker.isStreet=function(str){var regExp=/^[\u4e00-\u9fa5][\u4e00-\u9fa5\d\w\-#\(\) （）]+$/;return regExp.test(str);};JIFEN_TRIP.Checker.isLeapYear=function(str){var year=parseInt(str);if(isNaN(year)){return false;}else{if((year%4==0&&year%100!=0)||year%400==0){return true;}else{return false;}}};JIFEN_TRIP.Checker.isDateTime=function(str,type){if(str==''||type==''){return false;}
var lengthMap={'y':4,'M':6,'d':8,'h':10,'m':12,'s':14};if(type.toLowerCase()!='m'){type=type.toLowerCase();}
var time=str+'';var length=time.length;if(!lengthMap[type]||lengthMap[type]!=time.length){return false;}
if(type=='y'){time=time+'0101';}else if(type=='M'){time=time+'01';}
var zeroNum=14-time.length;for(var i=0;i<zeroNum;i++){time+='0';}
var regExp;var year=time.substr(0,4);if(JIFEN_TRIP.Checker.isLeapYear(year)){regExp=/^[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))([0-1][0-9]|2[0-3])([0-5][0-9]){2}$/;}else{regExp=/^[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))([0-1][0-9]|2[0-3])([0-5][0-9]){2}$/;}
return regExp.test(time);};JIFEN_TRIP.Checker.isCard=function(str,type){if(str.length>20){return false;}
if(type=="1"||type=="身份证"){return _isIdCard(str);}else if(type=="2"||type=="护照"){return _isPassPort(str);}else{return _isAllowedChars(str);}
function _isArmy(id){var regExp=/^[^&_<>\n\s]+$/;return regExp.test(id);}
function _isPassPort(id){var rePassport=/^[a-zA-Z0-9]([a-zA-Z0-9<]+( )?)*[a-zA-Z0-9<]$/;if(!rePassport.test(id)){return false;}
if(id.length>18){return false;}
return _isAllowedChars(id);}
function _isTaiwan(id){var regExp=/^[a-z\d]+(\([a-z\d]+\))+$/i;return regExp.test(id);}
function _isHK(id){var regExp=/^[a-z\d]+(\([a-z\d]\))?$/i;return regExp.test(id);}
function _isAllowedChars(id){var regExp=/^[^'"&_<>\n\s\t]+$/;return regExp.test(id);}
function _isIdCard(id){var prov={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};var idChars=id.split("");if(!prov[parseInt(id.substr(0,2))]){return false;}
switch(id.length){case 15:var year=parseInt(id.substr(6,2))+1900;if(JIFEN_TRIP.Checker.isLeapYear(year)){regExp=/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/;}else{regExp=/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/;}
return regExp.test(id);break;case 18:var year=id.substr(6,4);if(JIFEN_TRIP.Checker.isLeapYear(year)){regExp=/^[1-9][0-9]{5}[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/;}else{regExp=/^[1-9][0-9]{5}[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/;}
if(regExp.test(id)){var modulus,checkCodeList='10X98765432';var sum,code;sum=(parseInt(idChars[0])+parseInt(idChars[10]))*7+(parseInt(idChars[1])+parseInt(idChars[11]))*9+(parseInt(idChars[2])+parseInt(idChars[12]))*10+(parseInt(idChars[3])+parseInt(idChars[13]))*5+(parseInt(idChars[4])+parseInt(idChars[14]))*8+(parseInt(idChars[5])+parseInt(idChars[15]))*4+(parseInt(idChars[6])+parseInt(idChars[16]))*2+
parseInt(idChars[7])*1+
parseInt(idChars[8])*6+
parseInt(idChars[9])*3;modulus=sum%11;code=checkCodeList.substr(modulus,1);if(code==idChars[17]){return true;}else{return false;}}else{return false;}
break;default:return false;}}};/*  |xGv00|e87dd487f508337a40410577fc7ee1eb */