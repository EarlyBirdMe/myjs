/**
 * JavaScriot Sandbox
 * @author		tangbin
 * @date		2012-01-24
 * @see			http://code.google.com/p/script-sandbox/
 * @copyright	Copyright (c) 2012, planeArt.cn. All rights reserved.
 * @license		BSD
 * @constructor
 */var scriptSandbox=function(){var a=this,b=document.createElement("iframe");b.style.display="none",b.src="about:blank",b.sandbox="allow-scripts",(document.body||document.getElementsByTagName("head")[0]).appendChild(b),this.sandbox=b,this.window=b.contentWindow,this.document=b.contentDocument||b.contentWindow.document;var c=["<script>"],d=[],e=this.blacklist,f=e.length;for(var g=0,h;g<f;g++)h=e[g],c.push("try {"),h==="frameElement"?c.push("function ",h," () {}"):c.push('eval("function ',h,' () {}")'),c.push("} catch (e) {}"),d.push('<iframe name="',h,'"></iframe>');d=d.join(""),c.push("</script>"),c=c.join(""),this.document.open(),this.document.write("<html><head></head><body>"+c+"</body></html>"),this.document.close();var i=function(){var a=document.documentElement,b=document.head,c=document.body,d="__proto__";b&&a.removeChild(b),a.removeChild(c),document[d]&&($host.createElement=document[d].createElement);if(typeof this.parent=="object"){var e=document.createElement("div");e.innerHTML=$iframes,a.appendChild(e)}window[d]&&(window[d]={},document[d]={},delete a.innerHTML),this.document.createElement&&($host.createElement=document.createElement,document.createElement=null),this.onerror=function(a){return console.log(a),!0},this.sandbox=$sandbox,this.console=$console},j={$host:this,$iframes:d,$sandbox:{postMessage:function(b){a.message.apply(a,arguments)},message:function(){}},$console:window.console||{log:function(b){a.log(b)}},document:this.document};try{this.eval(i,j)}catch(k){this.log("scriptSandbox: Initialize Error!"),this.log(k)}};scriptSandbox.prototype={version:"0.1.3",getJSON:function(a,b,c){var d=+(new Date),e=c?"":"&callback=sandbox"+d,f=this.window;f[c]=function(a){if(window.JSON&&typeof a=="string")try{a=JSON.parse(a)}catch(c){}g(),b(a)};var g=function(){f[c]&&(f[c]=undefined)};this.getScript(a,function(){g()},e)},getScript:function(a,b){var c=arguments[2]||"",d=+(new Date),e=a.replace(/([?&])_=[^&]*/,"$1_="+d);a=e+(e===a?(/\?/.test(a)?"&":"?")+"_="+d:""),a=a+c;var f=this.document,g=this.createElement,h=g?g.call(f,"script"):f.createElement("script");h.async="async",h.onload=h.onreadystatechange=function(){var a=!h.readyState||/loaded|complete/.test(h.readyState);a&&(h.onload=h.onreadystatechange=null,f.documentElement.removeChild(h),b&&b())},h.src=a,f.documentElement.appendChild(h)},defined:function(a){for(var b in a)this.window[b]=a[b]},eval:function(a,b){var c=this.window,d=[],e=[];b=b||{};for(var f in b)d.push(f),e.push(b[f]);return a=a.toString(),a.indexOf("function")===0?a="return ("+a+").apply(this, arguments)":a="return ("+a+")",c.Function||(c.Function=window.Function),(new c.Function(d,a)).apply(c,e)},message:function(){},postMessage:function(a){this.window.sandbox.message(a)},close:function(){this.sandbox.src="about:blank",this.sandbox.parentNode.removeChild(this.sandbox)},log:function(a){window.console&&console.log(a)},blacklist:["top","parent","opener","frames","document","frameElement","alert","confirm","prompt","open","showModelessDialog","print","Image","ActiveXObject","XMLHttpRequest","WebSocket","execScript"]}